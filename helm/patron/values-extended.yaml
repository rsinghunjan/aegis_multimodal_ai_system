  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
# Helm values for a Patroni-based Postgres HA (example, adapt to chosen chart)
patroni:
  bootstrap:
    dcs:
      ttl: 30
      loop_wait: 10
      retry_timeout: 10
    initdb:
      - encoding: UTF8
  postgresql:
    parameters:
      max_connections: 200
      shared_buffers: 256MB
      wal_level: replica
      archive_mode: "on"
      archive_command: "envdir /etc/wal-g.d/env wal-g wal-push %p"
      max_wal_senders: 5
      wal_keep_segments: 64
  resources:
    requests:
      cpu: 500m
      memory: 1024Mi
    limits:
      cpu: 2
      memory: 4Gi

walG:
  enabled: true
  image:
    repository: walgalpine/wal-g
    tag: latest
  envFromSecret: aegis-backup-secrets
  s3:
    prefix: s3://aegis-backups/postgres
    region: us-east-1

replicaCount: 3
persistence:
  enabled: true
  size: 50Gi
  storageClass: gp2

# Post-deploy hooks / readiness checks
livenessProbe:
  enabled: true
readinessProbe:
  enabled: true
