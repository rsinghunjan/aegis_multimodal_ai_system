 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
# Example Helm values for bitnami/postgresql-ha (multi-AZ aware)
# NOTE: customize storageClassName and nodeAffinity / topologySpread for your cluster.
postgresql:
  auth:
    username: aegis
    database: aegisdb
    password: change_me_here # do NOT commit secrets; use external secret manager integrations
  replication:
    enabled: true
  # For production, prefer to use an external secret store or Helm secrets
persistence:
  enabled: true
  storageClass: "gp2" # replace with your zone-aware storageClass (e.g., gp3, premium-ssd)
  size: 50Gi
podDisruptionBudget:
  enabled: true
  minAvailable: 1

# Pod Anti-affinity / TopologySpread settings to spread across AZs
affinity:
  podAntiAffinity:
    requiredDuringSchedulingIgnoredDuringExecution:
      - labelSelector:
          matchExpressions:
            - key: app.kubernetes.io/name
              operator: In
              values:
                - postgresql
        topologyKey: topology.kubernetes.io/zone

# Resource requests (tune to your workload)
resources:
  limits:
    cpu: 2000m
    memory: 8Gi
  requests:
    cpu: 1000m
    memory: 4Gi

# WAL archiving / backup hooks (example): you may integrate with pgBackRest or custom scripts.
backup:
  enabled: false
  # Configure a cronjob or sidecar that runs pg_dump / pgbackrest and uploads to S3

# Example tolerations / nodeSelector for zone placement (optional)
# nodeSelector:
#   node.kubernetes.io/zone: zone-a

# NOTES:
# - For production multi-AZ, prefer a proven operator (Patroni/Zalando) or managed DB.
# - Ensure PersistentVolumes are zone aware and that the storageClass supports volumeBindingMode: WaitForFirstConsumer.
