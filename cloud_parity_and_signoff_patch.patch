*** Begin Patch
*** Add File: infra/oci/federation/README_oci_federation.md
+OCI Federation & Dynamic Group — Quickstart
+=========================================
+
+This guide contains tenancy-agnostic examples to configure OCI federation for Kubernetes workloads and a Dynamic Group that matches pods (via OKE OIDC or resource principal patterns). Edit placeholders with tenancy-specific OCIDs and names.
+
+What to do (high level)
+- Create or confirm an OIDC identity provider in OCI that trusts your cluster's OIDC issuer.
+- Create a Dynamic Group with a matching rule that identifies pods (for example by the OIDC subject claims when using OKE federation).
+- Create least-privilege policies granting the Dynamic Group only the necessary object-storage and key usage permissions.
+- Annotate the backup ServiceAccount (or use instance principals) so pods obtain short-lived credentials.
+
+Example Dynamic Group matching rule (replace values):
+
+  name: aegis-backup-dg
+  description: "Dynamic group for Aegis backup pods"
+  matching-rule: 
+    Any {resource.type = 'instance', resource.principal.id.namespace = 'ocid1.tenancy.oc1..example'} 
+    # OR for OIDC-subject based matching (OKE OIDC federation)
+    # Any {instance.compartment.id = 'ocid1.compartment.oc1..xxxxx'}
+
+Sample policy statements (narrow to compartment and bucket)
+
+  Allow dynamic-group aegis-backup-dg to read buckets in compartment ocid1.compartment.oc1..EXAMPLE
+  Allow dynamic-group aegis-backup-dg to manage objects in compartment ocid1.compartment.oc1..EXAMPLE where target.bucket.name = 'aegis-backup-bucket'
+  Allow dynamic-group aegis-backup-dg to use keys in compartment ocid1.compartment.oc1..EXAMPLE
+
+Notes & next steps
+- After creating the Dynamic Group and policy, deploy the Helm values setting serviceAccount.name to the backup SA and configure OKE to emit OIDC tokens or enable resource principals.
+- Use scripts/apply_oci_dynamic_group.sh to print commands and create the dynamic group when you have tenancy admin rights.
+
*** End Patch
*** Begin Patch
*** Add File: infra/alibaba/federation/README_alibaba_federation.md
+Alibaba Cloud (Alibaba Cloud OSS + KMS) — Federation & RAM Quickstart
+===================================================================
+
+Overview
+- Alibaba supports OIDC federation and RAM roles. For Kubernetes, configure an OIDC provider or use Workload Identity for your cluster provider (ACK).
+- Create a RAM role for backups and attach least-privilege policy statements scoped to the OSS bucket and KMS key.
+
+Example RAM policy (narrow scope)
+
+Policy name: AegisBackupPolicy
+Statements:
+  - Allow RAM role AegisBackupRole to perform oss:PutObject on resource "acs:oss:*:*:bucket/aegis-backup-bucket/*"
+  - Allow RAM role AegisBackupRole to perform oss:GetObject on resource "acs:oss:*:*:bucket/aegis-backup-bucket/*"
+  - Allow RAM role AegisBackupRole to perform kms:Encrypt kms:Decrypt on resource "acs:kms:*:*:key/*"
+
+Notes
+- Use the console or Resource Access Management CLI to create a RAM role and attach the policy above.
+- If using ACK, follow the ACK Workload Identity docs to map service accounts to RAM roles.
+- Use scripts/apply_alibaba_federation.sh to print resource names and sample policy snippets.
+
*** End Patch
*** Begin Patch
*** Add File: scripts/apply_oci_dynamic_group.sh
+#!/usr/bin/env bash
+set -euo pipefail
+#
+# apply_oci_dynamic_group.sh
+# Creates an OCI Dynamic Group and prints policy statements to apply.
+#
+# Usage:
+#   ./scripts/apply_oci_dynamic_group.sh --compartment <compartment-ocid> --name aegis-backup-dg --matching-rule "<rule>"
+#
+COMP=""
+DG_NAME=""
+MATCH_RULE=""
+
+while [ $# -gt 0 ]; do
+  case "$1" in
+    --compartment) COMP="$2"; shift 2;;
+    --name) DG_NAME="$2"; shift 2;;
+    --matching-rule) MATCH_RULE="$2"; shift 2;;
+    -h|--help) sed -n '1,200p' "$0"; exit 0;;
+    *) echo "Unknown arg $1"; exit 2;;
+  esac
+done
+
+if [ -z "$COMP" ] || [ -z "$DG_NAME" ] || [ -z "$MATCH_RULE" ]; then
+  echo "Usage: $0 --compartment <compartment-ocid> --name <dynamic-group-name> --matching-rule '<rule>'"
+  exit 2
+fi
+
+echo "[oci] Creating dynamic group ${DG_NAME} in compartment ${COMP}"
+echo "Note: this requires IAM permission iam.dynamic-group:create"
+set -x
+oci iam dynamic-group create --name "$DG_NAME" --matching-rule "$MATCH_RULE" --description "Aegis backup dynamic group" --compartment-id "$COMP" || {
+  echo "[oci] Failed to create dynamic group; printing suggested policy statements instead."
+}
+set +x
+
+echo
+echo "Suggested OCI Policy statements (apply via Console or CLI):"
+echo "Allow dynamic-group ${DG_NAME} to read buckets in compartment ${COMP}"
+echo "Allow dynamic-group ${DG_NAME} to manage objects in compartment ${COMP} where target.bucket.name = 'aegis-backup-bucket'"
+echo "Allow dynamic-group ${DG_NAME} to use keys in compartment ${COMP}"
+
*** End Patch
*** Begin Patch
*** Add File: scripts/apply_alibaba_federation.sh
+#!/usr/bin/env bash
+set -euo pipefail
+#
+# apply_alibaba_federation.sh
+# Prints example RAM role trust policy and oss/kms policy snippets for Aegis backups.
+#
+# Usage:
+#   ./scripts/apply_alibaba_federation.sh --bucket aegis-backup-bucket --role-name AegisBackupRole
+#
+BUCKET=""
+ROLE_NAME=""
+
+while [ $# -gt 0 ]; do
+  case "$1" in
+    --bucket) BUCKET="$2"; shift 2;;
+    --role-name) ROLE_NAME="$2"; shift 2;;
+    -h|--help) sed -n '1,200p' "$0"; exit 0;;
+    *) echo "Unknown arg $1"; exit 2;;
+  esac
+done
+
+if [ -z "$BUCKET" ] || [ -z "$ROLE_NAME" ]; then
+  echo "Usage: $0 --bucket <bucket-name> --role-name <ram-role-name>"
+  exit 2
+fi
+
+echo "RAM Role creation (example):"
+echo "aliyun ram CreateRole --RoleName $ROLE_NAME --AssumeRolePolicyDocument '{\"Statement\":[{\"Action\":\"sts:AssumeRole\",\"Effect\":\"Allow\",\"Principal\":{\"Service\":[\"ecs.aliyuncs.com\"]}}]}'"
+
+echo
+echo "Recommended RAM policy statements (attach to $ROLE_NAME):"
+cat <<EOF
+- Allow oss:PutObject on resource "acs:oss:*:*:bucket/${BUCKET}/*"
+- Allow oss:GetObject on resource "acs:oss:*:*:bucket/${BUCKET}/*"
+- Allow kms:Encrypt on resource "acs:kms:*:*:key/*"
+- Allow kms:Decrypt on resource "acs:kms:*:*:key/*"
EOF
+
+echo
+echo "If using ACK, map the Kubernetes ServiceAccount to this RAM role via Workload Identity or OIDC per ACK docs."
+
*** End Patch
*** Begin Patch
*** Add File: scripts/onprem_ha_check.sh
+#!/usr/bin/env bash
+set -euo pipefail
+#
+# onprem_ha_check.sh
+# Simple health & HA checks for a MinIO + Vault on-prem deployment used by Aegis.
+#
+# Checks:
+#  - MinIO: health via mc or s3api
+#  - Vault: HA status, seal status
+#  - PV/PVC: ready status for namespaces (default: aegis)
+#
+NAMESPACE="${NAMESPACE:-aegis}"
+MINIO_ALIAS="${MINIO_ALIAS:-minio}"
+VAULT_ADDR="${VAULT_ADDR:-http://127.0.0.1:8200}"
+
+echo "[onprem] Checking Kubernetes PV/PVC health in namespace ${NAMESPACE}"
+kubectl -n "${NAMESPACE}" get pvc -o wide || true
+kubectl -n "${NAMESPACE}" get pods -o wide || true
+
+if command -v mc >/dev/null 2>&1; then
+  echo "[onprem] Checking MinIO health via mc"
+  mc admin info "${MINIO_ALIAS}" || echo "[onprem] mc admin info failed (check mc alias)"
+else
+  echo "[onprem] mc CLI not found; attempting s3 ping via aws-cli if configured"
+  if command -v aws >/dev/null 2>&1; then
+    echo "[onprem] Attempting S3 list-buckets (may need endpoint override)"
+    aws s3 ls || echo "[onprem] aws s3 ls failed (endpoint/creds may be required)"
+  fi
+fi
+
+if command -v vault >/dev/null 2>&1; then
+  echo "[onprem] Checking Vault status at ${VAULT_ADDR}"
+  export VAULT_ADDR
+  vault status || echo "[onprem] vault status failed (check VAULT_ADDR and token)"
+  echo "[onprem] Vault HA info:"
+  vault operator raft list-peers || true
+else
+  echo "[onprem] vault CLI not found; skip Vault checks"
+fi
+
+echo "[onprem] On-prem HA checks complete. Collect logs and PV metrics for deeper inspection."
+
*** End Patch
*** Begin Patch
*** Add File: .github/workflows/per_cloud_ci_signoff.yml
+name: Per-Cloud CI Signoff Runner
+
+on:
+  workflow_dispatch:
+    inputs:
+      cloud:
+        description: "Target cloud to run signoff checks (aws|azure|gcp|oci|alibaba|onprem)"
+        required: true
+        default: aws
+
+permissions:
+  contents: read
+  id-token: write
+
+jobs:
+  signoff:
+    runs-on: ubuntu-latest
+    environment: dangerous-ops
+    steps:
+      - name: Checkout
+        uses: actions/checkout@v4
+        with:
+          fetch-depth: 0
+
+      - name: Setup kubeconfig (if provided)
+        run: |
+          if [ -n "${{ secrets.KUBE_CONFIG_DATA }}" ]; then
+            echo "${{ secrets.KUBE_CONFIG_DATA }}" | base64 --decode > /tmp/kubeconfig
+            mkdir -p $HOME/.kube
+            mv /tmp/kubeconfig $HOME/.kube/config
+          fi
+
+      - name: Run per-cloud signoff checks
+        env:
+          CLOUD: ${{ github.event.inputs.cloud }}
+        run: |
+          set -euo pipefail
+          echo "Running signoff checks for $CLOUD"
+          case "$CLOUD" in
+            aws)
+              echo "Triggering staged KMS rotation orchestrator (dry-run)"
+              chmod +x scripts/crosscloud_rotation_orchestrator.sh
+              ./scripts/crosscloud_rotation_orchestrator.sh --cloud aws --staging-namespace "${{ secrets.STAGING_NAMESPACE }}" --backup-cronjob "${{ secrets.AWS_BACKUP_CRONJOB }}" --run-drill no --out /tmp/aegis-artifacts || true
+              ;;
+            azure)
+              echo "Azure signoff: ensure rotate_kms_azure.sh and retention tests are callable"
+              chmod +x scripts/rotate_kms_azure.sh scripts/azure_retention_test.sh
+              ./scripts/azure_retention_test.sh --storage-account "${{ secrets.AZ_STORAGE_ACCOUNT }}" --container "${{ secrets.AZ_BACKUP_CONTAINER }}" --resource-group "${{ secrets.AZ_RESOURCE_GROUP }}" || true
+              ;;
+            gcp)
+              echo "GCP signoff: check rotated key creation (dry-run)"
+              chmod +x scripts/rotate_kms_gcp.sh scripts/reencrypt_gcp.sh
+              ./scripts/rotate_kms_gcp.sh --project "${{ secrets.GCP_PROJECT }}" --location "${{ secrets.GCP_LOCATION }}" --keyring "${{ secrets.GCP_KEYRING }}" --key-name "aegis-backup-$(date +%s)" --service-account "${{ secrets.GCP_BACKUP_SA }}" || true
+              ;;
+            oci)
+              echo "OCI signoff: ensure dynamic group and policies applied"
+              chmod +x scripts/apply_oci_dynamic_group.sh
+              ./scripts/apply_oci_dynamic_group.sh --compartment "${{ secrets.OCI_COMPARTMENT }}" --name "aegis-backup-dg" --matching-rule "${{ secrets.OCI_MATCHING_RULE }}" || true
+              ;;
+            alibaba)
+              echo "Alibaba signoff: print RAM policy hints"
+              chmod +x scripts/apply_alibaba_federation.sh
+              ./scripts/apply_alibaba_federation.sh --bucket "${{ secrets.ALIBABA_BACKUP_BUCKET }}" --role-name "AegisBackupRole" || true
+              ;;
+            onprem)
+              echo "On-prem signoff: run HA checks"
+              chmod +x scripts/onprem_ha_check.sh
+              ./scripts/onprem_ha_check.sh || true
+              ;;
+            *)
+              echo "Unknown cloud: $CLOUD"
+              exit 2
+              ;;
+          esac
+
+      - name: Upload signoff artifacts
+        if: always()
+        uses: actions/upload-artifact@v4
+        with:
+          name: signoff-${{ github.event.inputs.cloud }}
+          path: /tmp/aegis-artifacts || artifacts || true
+
+      - name: Notify completion
+        if: always()
+        run: |
+          echo "Per-cloud signoff run for ${{ github.event.inputs.cloud }} completed. Inspect artifacts and logs in the workflow run."
+
*** End Patch
*** Begin Patch
*** Add File: docs/finish_cloud_parity_and_signoff.md
+Finish Cloud Parity & Signoff — Checklist
+==========================================
+
+This document lists the remaining steps to finish parity across OCI, Alibaba and on‑prem, and how to use the new signoff workflow.
+
+OCI & Alibaba tenancy-specific tasks
+- Apply the federation and policies from infra/oci/federation/README_oci_federation.md and infra/alibaba/federation/README_alibaba_federation.md.
+- Use scripts/apply_oci_dynamic_group.sh and scripts/apply_alibaba_federation.sh to create dynamic groups / print RAM policy snippets.
+- Narrow policies to exact bucket names and key OCIDs; never apply account-wide wildcards.
+
+On‑prem HA & retention tuning
+- Run scripts/onprem_ha_check.sh to validate MinIO, Vault and PVC/PV health.
+- Tune MinIO erasure-coding, replication and PV storage classes for HA; ensure PV reclaim policies and node affinity are set.
+- Run retention tests using retention test scripts (existing) after enabling any retention/lock features in a staging environment.
+
+Per‑cloud CI signoff runs
+- Use Actions → Per-Cloud CI Signoff Runner → choose target cloud and run.
+- The workflow will attempt dry-run signoff steps and upload artifacts to the workflow run (download artifacts for audit).
+- After successful signoff, collect artifacts and create a signoff PR referencing them and requesting SRE + Security approvals.
+
+Effort estimates
+- OCI/Alibaba per-tenant federation + policy apply: ~1–2 days each (requires tenancy admin).
+- On-prem HA + retention tuning: ~1–3 days depending on infra.
+- Signoff runs & artifact collection: <1 day per cloud to run and collate results.
+
*** End Patch
*** End Patch
