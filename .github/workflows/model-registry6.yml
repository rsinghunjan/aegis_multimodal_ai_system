name: Model registry validation

on:
  push:
    paths:
      - 'model_registry/**'
  pull_request:
    paths:
      - 'model_registry/**'

jobs:
  validate-model-metadata:
    name: Validate model metadata
    runs-on: ubuntu-latest
    steps:
      - name: Checkout (full history)
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: Install validator deps
        run: |
          python -m pip install --upgrade pip
          pip install jsonschema pyyaml

      - name: Run metadata validator
        run: |
          python3 scripts/validate_model_metadata.py --all

      - name: Optional: Register model with MLflow (if configured)
        if: env.MLFLOW_TRACKING_URI != ''
        env:
          MLFLOW_TRACKING_URI: ${{ secrets.MLFLOW_TRACKING_URI }}
        run: |
          echo "MLflow configured: consider registering artifacts in a dedicated pipeline step."
          # Registering in CI requires MLflow server access and credentials; we recommend a separate workflow to run controlled registration.

  # Optionally add a job to run lightweight inference smoke tests using the artifact (if you provide small artifact)
