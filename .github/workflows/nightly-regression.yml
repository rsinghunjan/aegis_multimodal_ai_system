  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
name: Nightly regression suite

# Nightly run for a more comprehensive regression suite (full integration & heavy checks)
# Schedule: daily at 02:00 UTC (adjust cron as needed)
on:
  schedule:
    - cron: '0 2 * * *'
  workflow_dispatch:

jobs:
  nightly-regression:
    name: Nightly regression
    runs-on: ubuntu-latest
    timeout-minutes: 180
    steps:
      - name: Checkout (full history)
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: Install from lock
        run: |
          python -m pip install --upgrade pip
          if [ -f requirements.txt ]; then pip install -r requirements.txt; else echo "requirements.txt missing" && exit 1; fi

      - name: Boot integration infra
        run: |
          # Optionally start infra required for heavy tests (comment/uncomment and customize)
          # docker-compose -f docker-compose.observability.yaml -f docker-compose.postgres.yml up -d
          echo "Boot infra placeholder"

      - name: Run full test suite
        run: |
          # Run smoke + unit + integration + long tests
          if [ -f tests/smoke_test.py ]; then python -m pytest -q tests/smoke_test.py; fi
          python -m pytest -q || true
          if [ -d tests/integration ]; then python -m pytest -q tests/integration || true; fi

      - name: Collect artifacts & logs
        if: always()
        run: |
          mkdir -p /tmp/ci-artifacts || true
          # Example: copy logs or test reports to /tmp/ci-artifacts for upload via actions/upload-artifact if needed
          echo "Nightly run complete"
