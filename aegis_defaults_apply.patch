*** Begin Patch
*** Add File:deploy/defaults/deploy_with_defaults.sh
+#!/usr/bin/env bash
+set -euo pipefail
+#
+# deploy_with_defaults.sh
+# Orchestrator to apply Aegis production defaults (operator-run).
+#
+# Defaults chosen:
+#  - Clouds: AWS, GCP, Azure, IBM (OCI/Alibaba templated but not applied)
+#  - Managed stores: AWS ElastiCache (Redis) + hardened S3 for lakeFS
+#  - Vault: Helm RAFT deployment on Kubernetes
+#  - Tenant wiring: run tenant-finalization scripts for AWS/GCP/Azure/IBM (prints values to set as GitHub secrets)
+#
+# WARNING: This script prints commands and may call terraform/az/gcloud/aws/ibmcloud CLI.
+# Review each step and fill placeholder values before running. Do NOT run in production without review.
+#
+ROOT="$(cd "$(dirname "${BASH_SOURCE[0]}")/../.." && pwd)"
+echo "Aegis production-defaults deploy orchestrator"
+echo "Root: $ROOT"
+
+read -p "Proceed with defaults for AWS,GCP,Azure,IBM and managed ElastiCache + S3 lakeFS? (yes/no): " CONFIRM
+if [ "$CONFIRM" != "yes" ]; then
+  echo "Aborted by operator."
+  exit 1
+fi
+
+###############################################################################
+# 1) Tenant finalization (print commands / create artifacts)
+###############################################################################
+echo
+echo "==> Tenant finalization: AWS"
+bash "$ROOT/tenant-finalization/aws/finalize_aws_tenant.sh" --org "YOUR_GH_ORG" --repo "YOUR_REPO" --region "us-east-1" --s3-bucket "aegis-model-repo" --create-kms || true
+
+echo
+echo "==> Tenant finalization: GCP"
+bash "$ROOT/tenant-finalization/gcp/finalize_gcp_tenant.sh" --project "YOUR_GCP_PROJECT" --pool-id "aegis-pool" --provider-id "aegis-provider" --bucket "aegis-gcs-bucket" || true
+
+echo
+echo "==> Tenant finalization: Azure"
+bash "$ROOT/tenant-finalization/azure/finalize_azure_tenant.sh" --org "YOUR_GH_ORG" --repo "YOUR_REPO" --resource-group "aegis-rg" --vault-name "aegis-vault" --location "eastus" || true
+
+echo
+echo "==> Tenant finalization: IBM Cloud"
+bash "$ROOT/tenant-finalization/ibm/finalize_ibm_tenant.sh" --resource-group "aegis-rg" --cos-bucket "aegis-cos" --region "us-south" || true
+
+echo
+echo "Operator: copy printed GitHub secret values into your repository secrets now (use gh cli helper under tenant-finalization/ghcli/create_repo_secrets.sh if desired)."
+
+###############################################################################
+# 2) Provision managed services via Terraform (apply-ready module directories)
+###############################################################################
+echo
+echo "==> Terraform: managed services (ElastiCache + lakeFS S3 bucket + Vault infra)"
+read -p "Run terraform apply for managed modules now? (yes/no): " TF_CONFIRM
+if [ "$TF_CONFIRM" = "yes" ]; then
+  if [ -d "$ROOT/terraform/managed/aws" ]; then
+    pushd "$ROOT/terraform/managed/aws" >/dev/null
+    echo "Running terraform init && apply in terraform/managed/aws"
+    terraform init -input=false
+    terraform apply -auto-approve -var="stage=staging" || true
+    popd >/dev/null
+  fi
+  if [ -d "$ROOT/terraform/managed/s3" ]; then
+    pushd "$ROOT/terraform/managed/s3" >/dev/null
+    terraform init -input=false
+    terraform apply -auto-approve -var="stage=staging" || true
+    popd >/dev/null
+  fi
+  if [ -d "$ROOT/terraform/managed/vault" ]; then
+    pushd "$ROOT/terraform/managed/vault" >/dev/null
+    terraform init -input=false
+    terraform apply -auto-approve -var="stage=staging" || true
+    popd >/dev/null
+  fi
+else
+  echo "Skipping terraform apply. Run terraform manually when ready."
+fi
+
+###############################################################################
+# 3) Deploy Helm charts (Prometheus, Grafana, Vault RAFT if helm values present)
+###############################################################################
+echo
+echo "==> Deploying observability and Vault (Helm). Ensure kubectl context points to your staging cluster."
+kubectl config current-context || true
+read -p "Continue to helm deploy Prometheus,Grafana,Vault (requires helm & cluster access)? (yes/no): " HELM_CONFIRM
+if [ "$HELM_CONFIRM" = "yes" ]; then
+  kubectl create ns monitoring || true
+  helm repo add prometheus-community https://prometheus-community.github.io/helm-charts || true
+  helm repo add grafana https://grafana.github.io/helm-charts || true
+  helm repo add hashicorp https://helm.releases.hashicorp.com || true
+  helm repo update
+  helm upgrade --install prometheus prometheus-community/prometheus -n monitoring --wait || true
+  helm upgrade --install grafana grafana/grafana -n monitoring --wait || true
+  kubectl create ns vault || true
+  helm upgrade --install vault hashicorp/vault -n vault -f "$ROOT/prod/vault/values-production.yaml" --wait || true
+else
+  echo "Skipping helm deployments."
+fi
+
+###############################################################################
+# 4) Apply mTLS secrets and network policies
+###############################################################################
+echo
+echo "==> Apply mTLS secrets and network policies"
+read -p "Generate & apply mTLS secrets (cert-manager not installed by this script)? (yes/no): " MTLS_CONFIRM
+if [ "$MTLS_CONFIRM" = "yes" ]; then
+  bash "$ROOT/prod/security/mtls/generate_and_apply_mtls.sh" || true
+  kubectl apply -f "$ROOT/prod/security/networkpolicies/namespace-restrictive-policies.yaml" || true
+else
+  echo "Skipping mTLS & network policies step."
+fi
+
+###############################################################################
+# 5) Enable Vault audit forwarding (Fluentd) - operator must provide SIEM host
+###############################################################################
+echo
+echo "==> Vault audit forwarding"
+read -p "Apply Fluentd forwarder for Vault audit to syslog endpoint? (yes/no): " FWD_CONFIRM
+if [ "$FWD_CONFIRM" = "yes" ]; then
+  kubectl apply -f "$ROOT/prod/vault/audit_forwarding/fluentd_forwarder.yaml" -n ops || true
+  echo "Note: edit fluentd configmap to point to your SIEM host/port."
+else
+  echo "Skipping audit forwarder."
+fi
+
+###############################################################################
+# 6) Pentest orchestration & scans
+###############################################################################
+echo
+echo "==> Run pre-pentest scans and prepare vendor intake"
+read -p "Run local automated scans (trivy/kube-bench) now? (yes/no): " PTEST_CONFIRM
+if [ "$PTEST_CONFIRM" = "yes" ]; then
+  bash "$ROOT/prod/security/pentest/orchestrate_pentest.sh" || true
+else
+  echo "Skipping pre-pentest automated scans."
+fi
+
+###############################################################################
+# 7) Provision feature-store infra (Redis + lakeFS) via Helm (production values)
+###############################################################################
+echo
+echo "==> Deploy Feast backend infra"
+read -p "Deploy Redis (Bitnami) and lakeFS helm charts to cluster? (yes/no): " FS_CONFIRM
+if [ "$FS_CONFIRM" = "yes" ]; then
+  kubectl create ns feast || true
+  helm repo add bitnami https://charts.bitnami.com/bitnami || true
+  helm repo add lakefs https://charts.lakefs.io || true
+  helm repo update
+  helm upgrade --install aegis-redis bitnami/redis -n feast -f "$ROOT/prod/feature-store/helm/redis-cluster-values.yaml" --wait || true
+  helm upgrade --install lakefs lakefs/lakefs -n feast -f "$ROOT/prod/feature-store/helm/lakefs-values-production.yaml" --wait || true
+else
+  echo "Skipping feature-store helm deploy."
+fi
+
+###############################################################################
+# 8) Run DR drill (dry-run)
+###############################################################################
+echo
+echo "==> Run DR drill (dry-run)"
+read -p "Run DR drill script in dry-run mode now? (yes/no): " DR_CONFIRM
+if [ "$DR_CONFIRM" = "yes" ]; then
+  bash "$ROOT/prod/reliability/snapshot_and_dr/run_drill.sh" || true
+else
+  echo "Skipping DR drill."
+fi
+
+###############################################################################
+# 9) Triton perf sweep suggestion (operator must supply INFERENCE_HOST)
+###############################################################################
+echo
+echo "==> Triton perf sweep (local)"
+read -p "Run Triton perf quick test? Provide INFERENCE_HOST env var if you want to run (yes/no): " PERF_CONFIRM
+if [ "$PERF_CONFIRM" = "yes" ]; then
+  if [ -z "${INFERENCE_HOST:-}" ]; then
+    read -p "Enter INFERENCE_HOST (host:port or hostname from InferenceService status.url): " INFERENCE_HOST
+    export INFERENCE_HOST
+  fi
+  bash "$ROOT/prod/serving/perf/run_triton_perf.sh" --host "$INFERENCE_HOST" || true
+fi
+
+###############################################################################
+# 10) Final validation run
+###############################################################################
+echo
+echo "==> Final validation (lightweight)"
+bash "$ROOT/prod/validation/validate_end_to_end.sh" || true
+
+echo
+echo "Deploy defaults orchestration completed (you may need to inspect logs and follow up on printed actions)."
+echo "Operator: review all printed GitHub secrets and add them to your repository before re-running CI signing workflows."
+
*** End Patch
*** Add File:deploy/defaults/tfvars/aws.tfvars.example
+# Example tfvars for terraform/managed/aws
+stage = "staging"
+aws_region = "us-east-1"
+subnet_ids = ["subnet-0123456789abcdef0","subnet-0fedcba9876543210"]
+security_group_ids = ["sg-0123456789abcdef0"]
+node_type = "cache.m6g.large"
+num_nodes = 3
+
*** End Patch
*** Add File:deploy/defaults/tfvars/s3.tfvars.example
+region = "us-east-1"
+bucket_name = "aegis-lakefs-staging"
+kms_key_id = "arn:aws:kms:us-east-1:123456789012:key/REPLACE-KEY-ID"
+stage = "staging"
+
*** End Patch
*** Add File:deploy/defaults/runbook_defaults.md
+# Deploy with defaults — runbook
+
+This document explains how to run the defaults orchestration script and what to expect.
+
+Prereqs
+- kubectl with context pointing to staging cluster
+- helm, terraform, aws/gcloud/az/ibmcloud CLIs installed & configured
+- gh CLI (optional) to create repo secrets
+
+Steps
+1. Review and edit deploy/defaults/deploy_with_defaults.sh — replace placeholder values (YOUR_GH_ORG, YOUR_REPO, etc.)
+2. Run:
+   chmod +x deploy/defaults/deploy_with_defaults.sh
+   ./deploy/defaults/deploy_with_defaults.sh
+3. Follow prompts; the script will:
+   - Run tenant-finalization scripts (prints GitHub secrets)
+   - Optionally run terraform apply for managed modules (ElastiCache, S3)
+   - Deploy observability & Vault charts (Helm)
+   - Generate mTLS secrets and apply network policies (optional)
+   - Deploy Redis & lakeFS (Helm) (optional)
+   - Run DR drill (dry-run)
+   - Run a quick Triton perf test if you provide INFERENCE_HOST
+4. After the run:
+   - Add printed GitHub secrets to your repo
+   - Trigger CI signing workflows and validate Rekor entries
+   - Inspect Grafana dashboards and Prometheus alerts for SLO validation
+
+Notes & operator cautions
+- Review every printed IAM/KMS resource and tighten ARNs for least privilege.
+- Terraform apply will create real cloud resources and incur cost.
+- Do not run this script in production without thorough review.
+
*** End Patch
*** End Patch
