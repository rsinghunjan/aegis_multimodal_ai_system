*** Begin Patch
*** Add File: scripts/package_and_attest_rekor.sh
+#!/usr/bin/env bash
+#
+# Package + sign using cosign (keyless preferred) and record canonical DSSE attestation
+# that includes the Rekor entry UUID. Upload artifact + attestation + sbom to OBJECT_STORE_BUCKET.
+#
+# Requirements:
+#  - cosign (https://github.com/sigstore/cosign)
+#  - jq, openssl, awscli
+#  - REKOR_URL env optional (if present will be queried)
+#
+# Usage:
+#   OBJECT_STORE_BUCKET=... REKOR_URL=... ./scripts/package_and_attest_rekor.sh <model_dir> <artifact_out_path>
+set -euo pipefail
+
+MODEL_DIR="${1:-}"
+OUT_TAR="${2:-}"
+
+if [ -z "$MODEL_DIR" ] || [ -z "$OUT_TAR" ]; then
+  echo "Usage: $0 <model_dir> <artifact_out_path>"
+  exit 2
+fi
+if [ ! -d "$MODEL_DIR" ]; then
+  echo "Model dir not found: $MODEL_DIR" >&2
+  exit 3
+fi
+
+TMPDIR=$(mktemp -d)
+trap 'rm -rf "$TMPDIR"' EXIT
+
+echo "Creating deterministic archive..."
+if [ -x scripts/make_deterministic_archive.py ]; then
+  python3 scripts/make_deterministic_archive.py "$MODEL_DIR" "$OUT_TAR"
+else
+  find "$MODEL_DIR" -type f | sort > "$TMPDIR/files.list"
+  tar --sort=name --mtime='UTC 2020-01-01' -czf "$OUT_TAR" -T "$TMPDIR/files.list"
+fi
+
+echo "Computing digests..."
+DIGEST_HEX=$(openssl dgst -sha256 -binary "$OUT_TAR" | xxd -p -c 256)
+DIGEST_B64=$(openssl dgst -sha256 -binary "$OUT_TAR" | base64 -w 0)
+echo "sha256 (hex): $DIGEST_HEX"
+echo "sha256 (b64): $DIGEST_B64"
+
+SIGJSON="${OUT_TAR}.sig.json"
+ATTEST="${OUT_TAR}.attestation.json"
+SBOM="${OUT_TAR}.sbom.json"
+REKOR_UUID=""
+
+# Attempt cosign keyless sign-blob (preferred). cosign will upload to Rekor if configured.
+if command -v cosign >/dev/null 2>&1; then
+  echo "Signing with cosign (keyless if available)..."
+  set +e
+  # produce a signature file (base64)
+  cosign sign-blob --output-signature "$TMPDIR/sig.b64" --keyless "$OUT_TAR" >"$TMPDIR/cosign.out" 2>&1
+  COSIGN_RC=$?
+  set -e
+  if [ $COSIGN_RC -eq 0 ] && [ -f "$TMPDIR/sig.b64" ]; then
+    base64 -d "$TMPDIR/sig.b64" > "$TMPDIR/sig.bin" || true
+    SIG_B64=$(base64 -w0 "$TMPDIR/sig.bin" || true)
+    jq -n --arg sig "$SIG_B64" '{data:{signature:$sig}}' > "$SIGJSON"
+    echo "Cosign signature saved to $SIGJSON"
+    # Try to locate Rekor entry by querying Rekor /api/v1/index/retrieve with the hex hash (best-effort)
+    if [ -n "${REKOR_URL:-}" ]; then
+      echo "Querying Rekor for entries matching artifact hash..."
+      # Rekor expects hash format like "sha256:<hex>"
+      REQ_URL="${REKOR_URL%/}/api/v1/index/retrieve?hash=sha256:${DIGEST_HEX}"
+      set +e
+      REKOR_RESP=$(curl -sS "${REQ_URL}" || true)
+      set -e
+      if [ -n "$REKOR_RESP" ] && [ "$REKOR_RESP" != "null" ]; then
+        # response is a JSON object keyed by UUIDs; extract first key
+        REKOR_UUID=$(echo "$REKOR_RESP" | jq -r 'keys[0]' 2>/dev/null || true)
+        if [ -n "$REKOR_UUID" ] && [ "$REKOR_UUID" != "null" ]; then
+          echo "Found Rekor entry UUID: $REKOR_UUID"
+        else
+          echo "No Rekor UUID found in response (response length: $(echo -n "$REKOR_RESP" | wc -c))"
+        fi
+      else
+        echo "Rekor query returned empty or null"
+      fi
](#)
î€€
