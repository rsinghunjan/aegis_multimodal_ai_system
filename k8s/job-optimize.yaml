apiVersion: batch/v1
kind: Job
metadata:
  name: aegis-optimize-job
  namespace: default
spec:
  backoffLimit: 1
  template:
    spec:
      restartPolicy: Never
      containers:
        - name: optimizer
          image: ghcr.io/<ORG>/aegis-training:latest
          command: ["python", "scripts/optimize_model.py"]
          args:
            - --input
            - /data/input/model.pt
            - --input-type
            - torchscript
            - --example-input-shape
            - "1,3,32,32"
            - --model-name
            - my-model
            - --version
            - optimized-v1
            - --quantize
            - dynamic
            - --output-dir
            - /data/optimized
            - --register
            - --sign-key
            - aegis-model-sign
          env:
            - name: AWS_ACCESS_KEY_ID
              valueFrom:
                secretKeyRef:
                  name: minio-credentials
                  key: access_key
            - name: AWS_SECRET_ACCESS_KEY
              valueFrom:
                secretKeyRef:
                  name: minio-credentials
                  key: secret_key
          volumeMounts:
            - name: data
              mountPath: /data
      volumes:
        - name: data
          persistentVolumeClaim:
            claimName: optimizer-data-pvc
