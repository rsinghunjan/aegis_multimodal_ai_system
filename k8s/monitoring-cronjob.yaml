  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
apiVersion: batch/v1
kind: CronJob
metadata:
  name: aegis-model-monitor
  namespace: default
spec:
  schedule: "*/15 * * * *"   # run every 15 minutes
  jobTemplate:
    spec:
      template:
        spec:
          containers:
            - name: monitor
              image: ghcr.io/<ORG>/aegis-monitor:latest
              imagePullPolicy: IfNotPresent
              command: ["python", "scripts/monitor_drift.py"]
              args:
                - "--baseline"
                - "/data/baseline_stats.json"
                - "--live"
                - "/data/live_samples/latest_window.csv"
                - "--pushgateway"
                - "http://pushgateway:9091"
                - "--job-name"
                - "aegis-model-monitor"
                - "--model-name"
                - "my-model"
                - "--output"
                - "/data/reports/drift_report.json"
              env:
                - name: PUSHGATEWAY_URL
                  value: "http://pushgateway:9091"
                - name: MODEL_NAME
                  value: "my-model"
                - name: AWS_ACCESS_KEY_ID
                  valueFrom:
                    secretKeyRef:
                      name: minio-credentials
                      key: access_key
                - name: AWS_SECRET_ACCESS_KEY
                  valueFrom:
                    secretKeyRef:
                      name: minio-credentials
                      key: secret_key
              volumeMounts:
                - name: data
                  mountPath: /data
          restartPolicy: OnFailure
          volumes:
            - name: data
              persistentVolumeClaim:
                claimName: monitoring-data-pvc
