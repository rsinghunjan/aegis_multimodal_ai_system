  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
apiVersion: apps/v1
kind: Deployment
metadata:
  name: celery-beat
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app: celery-beat
  template:
    metadata:
      labels:
        app: celery-beat
    spec:
      serviceAccountName: celery
      containers:
        - name: celery-beat
          image: __IMAGE_PLACEHOLDER__
          command: ["celery", "-A", "api.celery_app.app", "beat", "--loglevel=info", "--scheduler=redbeat.RedBeatScheduler"]
          env:
            - name: AEGIS_BROKER_URL
              value: redis://redis:6379/0
            - name: REDIS_URL
              value: redis://redis:6379/0
      # Use leader election if running multiple replicas via a distributed lock (Redis/Leader)
      # Ensure ServiceAccount has permissions if using K8s API for leader election
