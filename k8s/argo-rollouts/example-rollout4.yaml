  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
apiVersion: argoproj.io/v1alpha1
kind: Rollout
metadata:
  name: aegis-model-rollout
  namespace: aegis
spec:
  replicas: 3
  strategy:
    canary:
      steps:
        - setWeight: 10
        - pause: {duration: 120}
        - setWeight: 50
        - pause: {duration: 120}
  selector:
    matchLabels:
      app: aegis-model
  template:
    metadata:
      labels:
        app: aegis-model
    spec:
      containers:
        - name: model
          image: aegis/model:canary
          ports:
            - containerPort: 8080
          readinessProbe:
            httpGet:
              path: /health
              port: 8080
            initialDelaySeconds: 5
            periodSeconds: 10
k8s/argo-rollouts/example-rollout.yaml
