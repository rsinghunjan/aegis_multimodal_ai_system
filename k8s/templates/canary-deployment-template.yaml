  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
apiVersion: apps/v1
kind: Deployment
metadata:
  name: aegis-api-canary
  labels:
    app: aegis-api
    role: canary
spec:
  replicas: 2
  selector:
    matchLabels:
      app: aegis-api
      role: canary
  template:
    metadata:
      labels:
        app: aegis-api
        role: canary
    spec:
      containers:
        - name: aegis-api
          image: __IMAGE_PLACEHOLDER__            # replaced by controller
          imagePullPolicy: IfNotPresent
          env:
            - name: MODEL_NAME
              value: "__MODEL_NAME__"
            - name: MODEL_VERSION
              value: "__MODEL_VERSION__"
            - name: DATABASE_URL
              value: "__DATABASE_URL__"           # optional; best to mount K8s secret
            - name: AEGIS_BROKER_URL
              value: "__AEGIS_BROKER_URL__"
          ports:
            - containerPort: 8080
          resources:
            requests:
              cpu: "500m"
              memory: "1Gi"
            limits:
              cpu: "2000m"
              memory: "8Gi"
      # Add nodeSelector/tolerations for GPU models here if needed
