
apiVersion: batch/v1
kind: Job
metadata:
  name: aegis-canary-load
  namespace: aegis
spec:
  template:
    spec:
      serviceAccountName: aegis-loadtester-sa
      restartPolicy: Never
      containers:
        - name: loadgen
          image: python:3.10-slim
          command: ["/bin/sh", "-c"]
          args:
            - pip install httpx && python3 -u /opt/aegis/scripts/simulate_canary_load.py --url http://aegis-staging.example.com/infer --qps 20 --duration 120 --error-rate 0.05
          volumeMounts:
            - name: scripts
              mountPath: /opt/aegis/scripts
      volumes:
        - name: scripts
