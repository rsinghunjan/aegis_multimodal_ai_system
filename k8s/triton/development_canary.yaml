 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
apiVersion: apps/v1
kind: Deployment
metadata:
  name: triton-canary
  namespace: aegis-canary
  labels:
    app: triton-canary
spec:
  replicas: 1
  selector:
    matchLabels:
      app: triton-canary
  template:
    metadata:
      labels:
        app: triton-canary
    spec:
      serviceAccountName: model-fetcher-sa
      initContainers:
        - name: verify-and-fetch
          image: ghcr.io/rsinghunjan/aegis-tools:latest
          command: ["/bin/sh", "-c"]
          args:
            - |
              set -euo pipefail
              /opt/aegis/verify_and_fetch.sh "s3://REPLACE_WITH_BUCKET/model-archives/demo/cifar-deepspeed-0.1/artifact.tar.gz" /models
          volumeMounts:
            - name: model-volume
              mountPath: /models
            - name: cosign-pub
              mountPath: /etc/cosign
              readOnly: true
      containers:
        - name: tritonserver
          image: nvcr.io/nvidia/tritonserver:23.08-py3
          args: ["tritonserver", "--model-repository=/models"]
          resources:
            limits:
              nvidia.com/gpu: "1"
          volumeMounts:
            - name: model-volume
              mountPath: /models
      volumes:
        - name: model-volume
          emptyDir: {}
        - name: cosign-pub
          secret:
            secretName: cosign-public-key
