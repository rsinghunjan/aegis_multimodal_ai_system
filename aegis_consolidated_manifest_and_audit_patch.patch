*** Begin Patch
*** Add File:docs/CONSOLIDATED_MANIFEST.md
+# Aegis — Consolidated Capability Manifest
+
+Purpose
+- Single canonical mapping of platform capabilities to repository artifacts, current readiness status, owner, and next actions.
+
+Status legend
+- DONE: Production-ready (or code + runbooks complete) — only validation/ops required.
+- STAGED: Works in staging; requires credentials, vendor onboarding, or final ops.
+- STUB: Scaffolding / prototype only — needs implementation.
+- MANUAL: Non-code tasks (legal, contracts, procurement).
+
+Table of capabilities
+
+- Crypto & Key Management
+  - Status: STAGED
+  - Owner: Security
+  - Files:
+    - quantum/crypto/hybrid_signer_hsm.py
+    - quantum/crypto/hsm_service.py
+    - quantum/hsm/validate_hsm_end_to_end.sh
+    - quantum/hsm/vendor_rotation_test.sh
+    - quantum/vault/write_hsm_config_and_pubkey.sh
+  - Next actions:
+    1. Provision vendor HSM in staging (cloud/hsm Terraform or vendor console).
+    2. Install PKCS#11 module on signing hosts and run validate_hsm_end_to_end.sh.
+    3. Verify audit log forwarding to S3 and SIEM (verify_audit_to_siem.py).
+  - Time estimate: 2–6 weeks (vendor dependent).
+
+- Provenance & Notarization (cosign + Rekor + MLflow)
+  - Status: STAGED
+  - Owner: Security / ML Platform
+  - Files:
+    - quantum/rekor/rekor_programmatic.py
+    - quantum/rekor/check_mlflow_rekor.py
+    - .github/workflows/rekor_enforce_mlflow.yml
+    - .github/workflows/enforce_rekor_on_main.yml
+  - Next actions:
+    1. Configure COSIGN/REKOR keys in Vault and CI secrets.
+    2. Run CI checks and collect auditor evidence (compliance/packager.py).
+  - Time estimate: 1–2 weeks.
+
+- Compute Backends & Pilots (Braket, IBM)
+  - Status: STAGED
+  - Owner: Quantum Team
+  - Files:
+    - providers/pilot/orchestrator.py
+    - providers/pilot/braket_full.py
+    - providers/pilot/ibm_full.py
+    - providers/pilot/run_all_pilots.sh
+    - quantum/pilot/verify_mlflow_and_playback.py
+    - repro/simulator_playback.py
+  - Next actions:
+    1. Write provider credentials to Vault (quantum/pilot/store_creds_and_run.sh).
+    2. Run 1–2 credentialed pilots per vendor and capture noise/calibration and raw shots.
+    3. Verify MLflow Rekor linkage and run simulator_playback.py against captured noise.
+  - Time estimate: 1–4 weeks per vendor.
+
+- Job Broker & Orchestration (Postgres, HPA, JWT, mTLS)
+  - Status: STAGED
+  - Owner: Platform / Infra
+  - Files:
+    - quantum/job_broker/app_postgres.py
+    - quantum/job_broker/db.py
+    - quantum/job_broker/worker_postgres_enhanced.py
+    - broker/helm/values-production.yaml
+    - broker/terraform/provision_rds_and_outputs.tf
+    - broker/scripts/deploy_broker_prod.sh
+    - broker/scripts/jwt_rotate_and_verify.sh
+  - Next actions:
+    1. Provision managed multi‑AZ Postgres (Terraform).
+    2. Install cert‑manager and apply issuer; enable mTLS.
+    3. Deploy Helm chart and run jwt rotation + HPA load test (broker/runbooks/load_test_hpa.sh).
+  - Time estimate: 1–3 weeks.
+
+- Observability & Cost Controls
+  - Status: STAGED
+  - Owner: Observability / FinOps
+  - Files:
+    - observability/prometheus_exporter.py
+    - observability/alertmanager_config.yaml
+    - observability/fallback_webhook_handler.py
+    - broker/quotas/chargeback_connector.py
+    - observability/cur/ingest_cur.sh
+  - Next actions:
+    1. Configure AWS CUR delivery to S3 and deploy Lambda/process (observability/cur/lambda_cur_processor.py).
+    2. Tune cost_enforcer thresholds and simulate cost spike (observability/test_cost_spike.sh).
+  - Time estimate: 1–3 weeks.
+
+- Reproducibility & Playback
+  - Status: STAGED
+  - Owner: Quantum Team
+  - Files:
+    - repro/simulator_playback.py
+    - repro/noise_capture_standard.py
+  - Next actions:
+    1. Normalize vendor noise snapshots and validate playback on pilot artifacts.
+  - Time estimate: 1–2 weeks.
+
+- Feature Store (Feast) & Data Lineage
+  - Status: STUB
+  - Owner: Data Platform
+  - Files:
+    - feature_store/feast/feature_repo.yaml
+    - feature_store/ingest/ingest_example.py
+  - Next actions:
+    1. Deploy Feast core (Redis/Online store) or adapt to managed option.
+    2. Implement ingestion pipelines and connect to training infra.
+  - Time estimate: 2–4 weeks.
+
+- Model Serving (Seldon / BentoML)
+  - Status: STUB
+  - Owner: ML Platform
+  - Files:
+    - serving/seldon/values.yaml
+    - serving/bentoml/Dockerfile
+    - serving/bentoml/model_server.py
+  - Next actions:
+    1. Build and push a sample model container; deploy Seldon/BentoML and test inference flows.
+  - Time estimate: 1–3 weeks.
+
+- Agentic Orchestration (Planner + Worker)
+  - Status: STUB
+  - Owner: Automation / Quantum
+  - Files:
+    - agent/orchestrator/planner.py
+    - agent/orchestrator/worker.py
+    - argo/workflows/run_now_workflow.yaml
+  - Next actions:
+    1. Replace file-polling worker with queue-backed executor (Argo/Argo Events or RabbitMQ).
+    2. Add auth, retries, and human approval gates.
+  - Time estimate: 2–4 weeks.
+
+- Explainability & Model Cards
+  - Status: STUB
+  - Owner: ML Platform
+  - Files:
+    - explainability/shap/run_shap.py
+  - Next actions:
+    1. Integrate SHAP runs into training pipelines and log artifacts to MLflow.
+  - Time estimate: 1–2 weeks.
+
+- Edge & OTA
+  - Status: STUB
+  - Owner: Edge / IoT
+  - Files:
+    - edge/packaging/Dockerfile.edge
+    - edge/agent/edge_agent.py
+    - edge/ota/ota_manifest.yaml
+  - Next actions:
+    1. Harden agent security, implement signed images and rollout strategy.
+  - Time estimate: 2–6 weeks.
+
+- CI / Automation & Orchestration
+  - Status: DONE (scaffold + workflows present)
+  - Owner: Platform / CI
+  - Files:
+    - operator/run_now_full_pipeline.sh
+    - argo/workflows/run_now_workflow.yaml
+    - ansible/playbooks/run_now.yml
+    - .github/workflows/* (Rekor gates, pilots)
+  - Next actions:
+    1. Wire CI secrets and run the main workflows.
+  - Time estimate: small ops work (days).
+
+- Compliance, Legal & SOC2
+  - Status: MANUAL
+  - Owner: Legal / Compliance
+  - Files:
+    - compliance/vendor_contracts/COUNTERSIGN_TEMPLATE.md
+    - compliance/legal/contract_signoff_template.md
+    - compliance/soc2/audit_request_template.md
+    - compliance/packager.py
+  - Next actions:
+    1. Legal to finalize vendor contracts and perform export-control review.
+    2. Run external SOC2 audit engagement with evidence bundle.
+  - Time estimate: 4–12+ weeks (parallel).
+
+Canonical references
+- Canonical run-now script: operator/run_now_full_pipeline.sh
+- HSM validation: quantum/hsm/validate_hsm_end_to_end.sh
+- Pilot orchestrator: providers/pilot/orchestrator.py
+- Broker deploy: broker/scripts/deploy_broker_prod.sh
+- Auditor packager: compliance/packager.py and compliance/audit_packager_enhanced.sh
+
+How to use this manifest
+1. Use this file as the single source of truth for status. Do not add new ad-hoc scripts without updating this manifest.
+2. Assign owners and update status in this file when tasks complete.
+
*** End Patch
*** Add File:docs/FINAL_ACCEPTANCE_CHECKLIST.md
+````markdown name=docs/FINAL_ACCEPTANCE_CHECKLIST.md
+# Final Acceptance Checklist — Canonical Run to Reach 100% Readiness
+
+This checklist provides a single canonical sequence to validate Aegis end-to-end in staging and cut over to production. Run these steps in order and collect artifacts into the auditor bundle.
+
+Prerequisites (operator)
+- AWS/GCP/Azure CLI configured with required privileges.
+- kubectl configured for target cluster with cluster-admin for cert-manager steps.
+- Vault CLI logged in as operator with policy to write/read required paths.
+- Terraform & Helm installed and authenticated.
+- COSIGN key available (in Vault or locally) and Rekor/cosign CLI installed on runners.
+- MLflow server reachable and accessible by orchestrator.
+
+High-level sequence
+1. HSM provisioning & validation (STAGED)
+   - Provision HSM (operator / vendor):
+     - If using CloudHSM: bash cloud/hsm/provision_cloudhsm.sh --tf-vars <path>
+     - Otherwise follow vendor console provisioning instructions.
+   - Install PKCS#11 module on signing host(s):
+     - ansible-playbook -i inventory quantum/hsm/ansible/install_pkcs11.yml --extra-vars "use_softhsm=false pkcs11_module=/opt/vendor/lib/pkcs11.so"
+   - Publish HSM config & public key to Vault:
+     - ./quantum/vault/write_hsm_config_and_pubkey.sh --vault-path secret/data/hsm/config --pkcs11-lib /opt/vendor/lib/pkcs11.so --slot 0 --pubkey /tmp/vendor_pub.pem
+   - Run end-to-end sign & audit validation:
+     - ./quantum/hsm/validate_hsm_end_to_end.sh --artifact /tmp/hsm-test.bin --pkcs11-lib /opt/vendor/lib/pkcs11.so --pkcs11-slot 0 --pkcs11-pin <PIN> --pkcs11-keylabel pqkey --s3-bucket <hsm-audit-bucket> --rekor
+   - Rotation test:
+     - Operator creates new key via vendor CLI, exports public key to /tmp/pqkey-v2.pub
+     - ./quantum/hsm/vendor_rotation_test.sh --vault-path secret/data/hsm/config --new-label pqkey-v2 --pubkey /tmp/pqkey-v2.pub --pkcs11-lib /opt/vendor/lib/pkcs11.so --slot 0 --pin <PIN> --artifact /tmp/hsm-test.bin --s3-bucket <hsm-audit-bucket>
+   - Acceptance:
+     - Successful hybrid-signature.json present and Rekor entry (if requested).
+     - HSM audit objects visible in s3://<hsm-audit-bucket>/hsm-audit/
+
+2. Credentialed pilots (STAGED)
+   - Publish credentials to Vault:
+     - ./quantum/pilot/store_creds_and_run.sh --vault-path secret/data/quantum/providers --provider braket --key braket_device --value <device_arn> --program /tmp/demo.qasm --s3-bucket <s3-bucket>
+     - ./quantum/pilot/store_creds_and_run.sh --vault-path secret/data/quantum/providers --provider ibm --key ibm_token --value <token> --program /tmp/demo.qasm --s3-bucket <s3-bucket> --ibm-backend <backend>
+   - Run pilots (use run_all_pilots.sh for convenience)
+     - bash providers/pilot/run_all_pilots.sh --program /tmp/demo.qasm --s3-bucket <s3-bucket> --vault-path secret/data/quantum/providers --ibm-backend <backend>
+   - Verify MLflow + Rekor linkage:
+     - python3 quantum/rekor/check_mlflow_rekor.py --mlflow-url <MLFLOW_URL> --experiment quantum-pilots --threshold 5
+   - Simulator playback validation:
+     - python3 repro/simulator_playback.py --qasm /tmp/demo.qasm --noise <noise_json_path>
+   - Acceptance:
+     - MLflow runs exist with `rekor.entry` tags and artifacts (meta, noise, raw shots) stored in S3.
+     - Simulator_playback reproduces expected distributions within documented variance.
+
+3. Broker production cutover (STAGED)
+   - Provision managed Postgres via Terraform:
+     - bash broker/scripts/deploy_broker_prod.sh --tf-vars ./broker/terraform/prod.tfvars --namespace aegis --helm-release aegis-quantum-broker
+   - Ensure secrets exist (JOB_DATABASE_URL, BROKER_API_JWT_SECRET) via Vault/external-secrets.
+   - Install cert-manager (if not present):
+     - kubectl apply -f https://github.com/cert-manager/cert-manager/releases/latest/download/cert-manager.yaml
+     - kubectl apply -f broker/k8s/cert-manager-issuer.yaml
+   - Deploy Helm chart (production values):
+     - helm upgrade --install aegis-quantum-broker broker/helm -n aegis --values broker/helm/values-production.yaml
+   - Rotate JWT and verify:
+     - ./broker/scripts/jwt_rotate_and_verify.sh aegis aegis-broker-secret
+   - HPA autoscale test:
+     - Obtain valid JWT and run: ./broker/runbooks/load_test_hpa.sh <broker-url> <JWT> 100
+   - Acceptance:
+     - Broker responds to health checks, mTLS validated, JWT rotation non-disruptive, HPA scales under load.
+
+4. CI / Auditor certification (STAGED → DONE)
+   - Enable Rekor PR/Main gates in GitHub (see .github/workflows/enforce_rekor_on_main.yml).
+   - Run Rekor auditor report:
+     - .github/workflows/rekor_auditor_report.yml (or run locally: compliance/packager.py)
+   - Produce deterministic signing README and evidence bundle:
+     - compliance/auditor/deterministic_signing_README.md
+     - python3 compliance/packager.py --out <outdir>
+   - Acceptance:
+     - CI gates enforce Rekor presence for promoted artifacts; auditor has deterministic steps and evidence bundle.
+
+5. Observability & Billing (STAGED)
+   - Set up AWS CUR to deliver to S3 and deploy the CUR processor (observability/cur/lambda_cur_processor.py).
+   - Run ingestion:
+     - observability/cur/ingest_cur.sh s3://<cur-path> /tmp/aegis_cur default
+   - Simulate cost spike:
+     - observability/test_cost_spike.sh /tmp/fake_billing.csv default
+   - Acceptance:
+     - cost_enforcer sets broker fallback; Alertmanager webhook triggers fallback handler; fallback state visible via /admin/get-fallback.
+
+6. Legal & Compliance (MANUAL)
+   - Send contract_signoff_template.md to legal and vendor; finalize counter-signed contract.
+   - Run export-control review per compliance/legal/export_control_runbook.md.
+   - Schedule and run SOC2 auditor engagement and provide the evidence bundle.
+   - Acceptance: Signed contracts in compliance/evidence, export-control decisions recorded, SOC2 audit completed.
+
+Canonical commands (summary)
+- Validate HSM: ./quantum/hsm/validate_hsm_end_to_end.sh ...
+- Run pilots: bash providers/pilot/run_all_pilots.sh --program /tmp/demo.qasm --s3-bucket <bucket> --vault-path <vaultpath>
+- Deploy broker: bash broker/scripts/deploy_broker_prod.sh --tf-vars ./broker/terraform/prod.tfvars
+- Run auditor packager: python3 compliance/packager.py
+- Run the automated "one-button" orchestration (careful; operator must review): bash operator/run_now_full_pipeline.sh --skip-confirm ...
+
+Notes
+- Run each step in a controlled staging environment before promoting to production.
+- Save the output of each validation (hybrid-signature.json, Rekor JSON, MLflow run IDs, broker logs) into the auditor evidence bundle.
+
+````

*** End Patch
*** Add File:operator/audit_inventory.sh
+#!/usr/bin/env bash
+#
+# Simple audit inventory script — checks presence of key artifacts and performs lightweight sanity checks.
+# Usage: ./operator/audit_inventory.sh [--output report.json]
+set -euo pipefail
+
+OUT="${1:-/tmp/aegis_audit_inventory.json}"
+
+check_file() {
+  local f="$1"
+  if [ -e "$f" ]; then
+    echo "present"
+  else
+    echo "missing"
+  fi
+}
+
+declare -A items
+items["hybrid_signer"]="quantum/crypto/hybrid_signer_hsm.py"
+items["hsm_service"]="quantum/crypto/hsm_service.py"
+items["hsm_validate"]="quantum/hsm/validate_hsm_end_to_end.sh"
+items["hsm_rotation"]="quantum/hsm/vendor_rotation_test.sh"
+items["rekor_program"]="quantum/rekor/rekor_programmatic.py"
+items["rekor_ci_check"]="quantum/rekor/check_mlflow_rekor.py"
+items["pilot_orchestrator"]="providers/pilot/orchestrator.py"
+items["braket_adapter"]="providers/pilot/braket_full.py"
+items["ibm_adapter"]="providers/pilot/ibm_full.py"
+items["broker_app"]="quantum/job_broker/app_postgres.py"
+items["broker_db"]="quantum/job_broker/db.py"
+items["worker"]="quantum/job_broker/worker_postgres_enhanced.py"
+items["helm_values"]="broker/helm/values-production.yaml"
+items["rds_tf"]="broker/terraform/provision_rds_and_outputs.tf"
+items["deploy_broker_script"]="broker/scripts/deploy_broker_prod.sh"
+items["run_now_script"]="operator/run_now_full_pipeline.sh"
+items["auditor_packager"]="compliance/packager.py"
+items["mlflow_check_workflow"]=" .github/workflows/rekor_enforce_mlflow.yml"
+items["enforce_rekor_main"]=".github/workflows/enforce_rekor_on_main.yml"
+
+report="{\"timestamp\":\"$(date -u +"%Y-%m-%dT%H:%M:%SZ")\",\"inventory\":{"
+first=true
+for k in "${!items[@]}"; do
+  f="${items[$k]}"
+  status=$(check_file "$f")
+  if [ "$first" = true ]; then first=false; else report="${report},"; fi
+  report="${report}\"${k}\":{\"path\":\"${f}\",\"status\":\"${status}\"}"
+done
+report="${report}}"
+
+# Lightweight checks (optional)
+report="${report},\"checks\":{"
+check_entries=()
+
+# Check python is available
+if command -v python3 >/dev/null 2>&1; then
+  check_entries+=("\"python\":\"ok\"")
+else
+  check_entries+=("\"python\":\"missing\"")
+fi
+
+# Check terraform availability
+if command -v terraform >/dev/null 2>&1; then
+  check_entries+=("\"terraform\":\"ok\"")
+else
+  check_entries+=("\"terraform\":\"missing\"")
+fi
+
+report="${report}$(IFS=,; echo "${check_entries[*]}")"
+report="${report}}"
+report="${report}}"
+
+echo "$report" | jq . > "${OUT}"
+echo "Inventory written to ${OUT}"
+
+# Exit non-zero if any critical staged items missing
+missing=0
+critical_keys=("hybrid_signer" "hsm_service" "hsm_validate" "rekor_program" "pilot_orchestrator" "broker_app" "deploy_broker_script" "run_now_script")
+for k in "${critical_keys[@]}"; do
+  path="${items[$k]}"
+  if [ ! -e "$path" ]; then
+    echo "CRITICAL MISSING: ${path}"
+    missing=1
+  fi
+done
+
+if [ "$missing" -ne 0 ]; then
+  echo "One or more critical files are missing. See ${OUT}"
+  exit 2
+fi
+
+echo "Critical files present."
+exit 0
+
*** End Patch
