*** Begin Patch
*** Add File: k8s/milvus-values-prod.yaml
+## Production Milvus Helm values for Aegis
+## Override sensitive values via CI secrets or Helm value files.
+
+persistence:
+  enabled: true
+  storageClass: "standard"
+  size: 500Gi
+
+security:
+  enableTLS: true
+  tls:
+    # Expect Kubernetes TLS Secret names to be provided via Helm --set or secret mounts
+    certSecret: aegis-milvus-tls
+  enableAuth: true
+  rootPasswordSecretName: aegis-milvus-root
+
+service:
+  type: ClusterIP
+
+resources:
+  limits:
+    cpu: "16"
+    memory: "64Gi"
+  requests:
+    cpu: "4"
+    memory: "16Gi"
+
+backup:
+  enabled: true
+  schedule: "0 3 * * *"
+  # Backup provider configuration should be provided by secret values overriding this
+  provider: gcs
+  gcs:
+    bucket: "gs://<YOUR_BUCKET>/milvus-backups/"
+
+monitoring:
+  enabled: true
+  prometheus:
+    enabled: true
+
+replica:
+  count: 3
+
*** End Patch
*** Begin Patch
*** Add File: k8s/cert-manager-issuer.yaml
+apiVersion: cert-manager.io/v1
+kind: ClusterIssuer
+metadata:
+  name: aegis-issuer
+spec:
+  selfSigned: {}
+
+---
+apiVersion: cert-manager.io/v1
+kind: Certificate
+metadata:
+  name: aegis-milvus-cert
+  namespace: aegis
+spec:
+  secretName: aegis-milvus-tls
+  dnsNames:
+    - "aegis-milvus.aegis.svc"
+  issuerRef:
+    name: aegis-issuer
+    kind: ClusterIssuer
+
*** End Patch
*** Begin Patch
*** Add File: scripts/milvus_setup_hardening.sh
+#!/usr/bin/env bash
+set -euo pipefail
+#
+# Milvus hardening helper (run once after Helm install)
+# - create root password secret
+# - create minimal user accounts and restrict network access via NetworkPolicy
+# - create snapshot/backup credentials (GCS or S3) in k8s secret
+
+NAMESPACE="${NAMESPACE:-aegis}"
+ROOT_PASS="${ROOT_PASS:-$(openssl rand -hex 24)}"
+GCS_BUCKET="${GCS_BUCKET:-}"
+
+echo "Creating root password secret in namespace ${NAMESPACE}"
+kubectl create secret generic aegis-milvus-root --from-literal=rootPassword="${ROOT_PASS}" -n "${NAMESPACE}" --dry-run=client -o yaml | kubectl apply -f -
+
+if [ -n "$GCS_BUCKET" ]; then
+  echo "Create GCS backup secret (expect service account key in GCS_KEY_JSON)"
+  if [ -z "${GCS_KEY_JSON:-}" ]; then
+    echo "Set GCS_KEY_JSON env with service account JSON contents"
+  else
+    kubectl create secret generic aegis-milvus-backup-gcs --from-literal=key="${GCS_KEY_JSON}" -n "${NAMESPACE}" --dry-run=client -o yaml | kubectl apply -f -
+  fi
+fi
+
+echo "Apply a minimal NetworkPolicy to restrict Milvus access to Aegis namespace only"
+cat <<'YAML' | kubectl apply -n "${NAMESPACE}" -f -
+apiVersion: networking.k8s.io/v1
+kind: NetworkPolicy
+metadata:
+  name: milvus-restrict
+spec:
+  podSelector:
+    matchLabels:
+      app: milvus
+  policyTypes:
+    - Ingress
+  ingress:
+    - from:
+        - namespaceSelector:
+            matchLabels:
+              name: aegis
+      ports:
+        - protocol: TCP
+          port: 19530
+        - protocol: TCP
+          port: 19121
+YAML
+
+echo "Milvus hardening helper completed. Note: enable TLS certs and monitoring via Helm values."
+
*** End Patch
*** Begin Patch
*** Add File: k8s/milvus-servicemonitor.yaml
+apiVersion: monitoring.coreos.com/v1
+kind: ServiceMonitor
+metadata:
+  name: milvus-servicemonitor
+  namespace: monitoring
+spec:
+  selector:
+    matchLabels:
+      app: milvus
+  namespaceSelector:
+    matchNames:
+      - aegis
+  endpoints:
+    - port: http
+      interval: 30s
+      path: /metrics
+      scheme: http
+
*** End Patch
*** Begin Patch
*** Add File: k8s/milvus-prometheus-rule.yaml
+apiVersion: monitoring.coreos.com/v1
+kind: PrometheusRule
+metadata:
+  name: milvus-alerts
+  namespace: monitoring
+spec:
+  groups:
+    - name: milvus.rules
+      rules:
+        - alert: MilvusDown
+          expr: up{job="milvus"} == 0
+          for: 5m
+          labels:
+            severity: critical
+          annotations:
+            summary: "Milvus service is down in Aegis"
+            description: "Milvus metrics not scraped for 5m."
+        - alert: MilvusHighLatency
+          expr: histogram_quantile(0.95, sum(rate(http_request_duration_seconds_bucket{job="milvus"}[5m])) by (le))
+          for: 10m
+          labels:
+            severity: warning
+          annotations:
+            summary: "Milvus high tail latency"
+            description: "95th percentile Milvus latency is high"
+
*** End Patch
*** Begin Patch
*** Add File: k8s/llm-gateway-prod.yaml
+apiVersion: apps/v1
+kind: Deployment
+metadata:
+  name: aegis-llm-gateway
+  namespace: aegis
+spec:
+  replicas: 3
+  selector:
+    matchLabels:
+      app: aegis-llm-gateway
+  template:
+    metadata
î€€
