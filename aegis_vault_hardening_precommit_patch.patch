*** Begin Patch
*** Add File: helm/vault/values-hardened.yaml
+# Hardened Vault Helm values (operator must review & fill cloud-specific placeholders)
+# - Replicas: 3 (HA)
+# - Persistence: enabled (PVC template provided)
+# - Auto-unseal: placeholder block for AWS/GCP/IBM Key Protect (fill with ARNs/CRNs)
+# - Audit logging: file-based under /vault/logs (forward to SIEM in production)
+# - TLS: placeholders for certSecret and CA (operator must provide)
+
+global:
+  enabled: true
+
+server:
+  image:
+    repository: "hashicorp/vault"
+    tag: "1.14.3" # pin to a known-good version; update after review
+  replicas: 3
+  affinity: |
+    podAntiAffinity:
+      preferredDuringSchedulingIgnoredDuringExecution:
+        - weight: 100
+          podAffinityTerm:
+            labelSelector:
+              matchExpressions:
+                - key: "app.kubernetes.io/name"
+                  operator: In
+                  values:
+                    - vault
+            topologyKey: "kubernetes.io/hostname"
+  resources:
+    requests:
+      cpu: "250m"
+      memory: "512Mi"
+    limits:
+      cpu: "1000m"
+      memory: "2Gi"
+
+  # TLS — operator must provide cert secret name
+  tls:
+    enabled: true
+    # certSecret should contain tls.crt & tls.key for Vault server
+    certSecret: "REPLACE_WITH_VAULT_TLS_SECRET"
+
+  # Persistence
+  dataStorage:
+    enabled: true
+    storageClass: "REPLACE_WITH_PERSISTENT_STORAGE_CLASS"
+    accessMode: ReadWriteOnce
+    size: 20Gi
+
+  # Audit devices
+  audit:
+    enabled: true
+    file:
+      enabled: true
+      path: "/vault/logs/vault_audit.log"
+      # rotate via host tooling or sidecar — operator responsibility
+
+  # Metrics & Prometheus
+  metrics:
+    enabled: true
+    serviceMonitor:
+      enabled: true
+
+  # Auto-unseal configuration (placeholders)
+  # Fill only one provider block with real values for your tenancy.
+  # AWS KMS example (operator must supply key_id & region & role)
+  autoUnseal:
+    enabled: true
+    # provider: "aws" | "gcp" | "ibm"
+    provider: "REPLACE_WITH_PROVIDER"
+    aws:
+      kms_key_id: "REPLACE_WITH_AWS_KMS_KEY_ID"
+      region: "REPLACE_WITH_AWS_REGION"
+      role_arn: "REPLACE_WITH_ROLE_ARN_ALLOWED_TO_USE_KMS"
+    gcp:
+      key_resource_id: "REPLACE_WITH_GCP_KMS_KEY_RESOURCE_ID"
+      credentials_json_secret: "REPLACE_WITH_K8S_SECRET_NAME_CONTAINING_SERVICE_ACCOUNT_JSON"
+    ibm:
+      key_protect_crn: "REPLACE_WITH_KEY_PROTECT_CRN"
+      api_key_secret: "REPLACE_WITH_K8S_SECRET_NAME_CONTAINING_IBM_API_KEY"
+
+  # Security: Do not expose root token; use sealed/unsealed workflow and store root unseal details in HSM/Vault operator store
+  extraEnvironmentVars:
+    VAULT_LOG_LEVEL: "info"
+
+  # Pod security context & node placement (example)
+  podAnnotations:
+    prometheus.io/scrape: "true"
+    prometheus.io/port: "8200"
+
+  # Init containers or sidecars for backup can be added by operator as needed
+
+# Notes for operator:
+# - Replace placeholders before helm upgrade/install.
+# - Ensure persistent volumes are backed by encrypted storage in your cloud/on-prem.
+# - Configure RBAC & NetworkPolicy to restrict access to Vault only from control plane & authorized nodes.
+
*** End Patch
*** Begin Patch
*** Add File: k8s/vault/pvc.yaml
+apiVersion: v1
+kind: PersistentVolumeClaim
+metadata:
+  name: vault-data-pvc
+  namespace: ops
+  labels:
+    app: vault
+spec:
+  accessModes:
+    - ReadWriteOnce
+  resources:
+    requests:
+      storage: 20Gi
+  storageClassName: "REPLACE_WITH_PERSISTENT_STORAGE_CLASS"
+
*** End Patch
*** Begin Patch
*** Add File: .pre-commit-config.yaml
+repos:
+  - repo: https://github.com/Yelp/detect-secrets
+    rev: v1.5.1
+    hooks:
+      - id: detect-secrets
+        args: ['--baseline', '.secrets.baseline']
+  - repo: https://github.com/pre-commit/pre-commit-hooks
+    rev: v4.5.0
+    hooks:
+      - id: trailing-whitespace
+      - id: end-of-file-fixer
+      - id: check-yaml
+  - repo: local
+    hooks:
+      - id: block-secret-paths
+        name: Block known secret output paths
+        entry: scripts/precommit/check_no_secret_paths.sh
+        language: script
+        files: ''
+
*** End Patch
*** Begin Patch
*** Add File: scripts/precommit/install_precommit.sh
+#!/usr/bin/env bash
+set -euo pipefail
+#
+# Bootstrap pre-commit and detect-secrets baseline for developer machines.
+#
+if ! command -v python3 >/dev/null 2>&1; then
+  echo "python3 required. Install it and re-run."
+  exit 1
+fi
+
+pip3 install --user pre-commit detect-secrets
+
+echo "Installing pre-commit git hook..."
+pre-commit install
+
+# Create a baseline if none exists (developer should review)
+if [ ! -f .secrets.baseline ]; then
+  echo "Generating detect-secrets baseline; review .secrets.baseline and commit it if acceptable."
+  detect-secrets scan > .secrets.baseline
+else
+  echo "Existing .secrets.baseline found; skip baseline generation."
+fi
+
+echo "Pre-commit installed. Run 'pre-commit run --all-files' to validate current tree."
+
*** End Patch
*** Begin Patch
*** Add File: scripts/precommit/check_no_secret_paths.sh
+#!/usr/bin/env bash
+set -euo pipefail
+#
+# Prevent committing files in known secret output directories (example: scripts/ibm/out)
+#
+STAGED_FILES=$(git diff --cached --name-only)
+
+for f in $STAGED_FILES; do
+  case "$f" in
+    scripts/ibm/out/*|*/secrets/*|helm/vault/values-prod-*.yaml)
+      echo "ERROR: Attempt to commit file in secret or generated-output path: $f"
+      echo "Remove the file from the commit (git reset <file>) and ensure secrets are stored in Vault."
+      exit 1
+      ;;
+    *)
+      ;;
+  esac
+done
+
+exit 0
+
*** End Patch
*** Begin Patch
*** Add File: .github/workflows/claim_evidence_check.yml
+name: PR: Claim Evidence & Secret Checks
+
+on:
+  pull_request:
+    types: [opened, synchronize, reopened]
+  push:
+    branches:
+      - main
+
+permissions:
+  contents: read
+  id-token: write
+
+jobs:
+  preflight:
+    runs-on: ubuntu-latest
+    steps:
+      - name: Checkout
+        uses: actions/checkout@v4
+        with:
+          fetch-depth: 0
+
+      - name: Set up Python
+        uses: actions/setup-python@v4
+        with:
+          python-version: '3.10'
+
+      - name: Install pre-commit & detect-secrets
+        run: |
+          python -m pip install --upgrade pip
+          pip install pre-commit detect-secrets
+
+      - name: Run pre-commit checks (includes detect-secrets)
+        run: |
+          pre-commit run --all-files
+
+      - name: Run claim evidence validator (if artifacts present)
+        run: |
+          chmod +x scripts/ci/validate_claim_evidence.sh
+          ./scripts/ci/validate_claim_evidence.sh --artifacts artifacts || echo "Claim evidence check failed or artifacts missing; see artifacts/ for details" && exit 0
+        continue-on-error: true
+
+      - name: Note on artifacts
+        run: |
+          echo "If the orchestrator produced artifacts, validate logs and attach them to PR or release notes."
+
*** End Patch
*** Begin Patch
*** Add File: docs/VAULT_HARDENING_AND_CI.md
+# Vault Hardening & CI: What this patch provides and operator steps
+
+This patch adds:
+- A hardened Helm values file: helm/vault/values-hardened.yaml (operator must review and fill placeholders)
+- A PVC example: k8s/vault/pvc.yaml (replace storageClass)
+- Pre-commit configuration that includes detect-secrets and a custom hook to block committing generated secret outputs.
+- A small install script for pre-commit and detect-secrets: scripts/precommit/install_precommit.sh
+- A GitHub Actions workflow: .github/workflows/claim_evidence_check.yml, which runs pre-commit checks and the claim evidence validator on PRs.
+
+Operator checklist (apply before running in production)
+1. Review & edit helm/vault/values-hardened.yaml:
+   - Replace placeholders: TLS secret name, storageClass, auto-unseal provider fields (KMS key/resource identifiers).
+   - Confirm replicas (default 3) and resource requests/limits for your cluster size.
+
+2. Create the PVC or configure your dynamic storage class:
+   - Edit k8s/vault/pvc.yaml and apply it to the 'ops' namespace (or update values to use dynamic provisioning).
+
+3. Install Vault via Helm (example):
+   - helm repo add hashicorp https://helm.releases.hashicorp.com
+   - helm repo update
+   - helm upgrade --install vault hashicorp/vault -n ops --create-namespace -f helm/vault/values-hardened.yaml
+
+4. Bootstrap & unseal:
+   - If you use auto-unseal with AWS/GCP/IBM, ensure the IAM/Service Account and network access are configured for Vault.
+   - Use your operator HSM/KMS process to store root tokens securely and avoid printing them into logs.
+
+5. Developer onboarding (pre-commit):
+   - Run scripts/precommit/install_precommit.sh to install pre-commit & generate a detect-secrets baseline.
+   - Developers should review .secrets.baseline and update it when necessary with `detect-secrets audit`.
+
+6. CI behavior:
+   - The GitHub Action runs pre-commit checks on PRs and the claim evidence validator (if artifacts exist in the repo).
+   - The claim evidence validator is advisory in this workflow; you can change 'continue-on-error' or fail hard once you have established the artifact collection process.
+
+Security notes & recommendations
+- Never commit secrets into Git; use the provided pre-commit hook and CI checks to catch mistakes.
+- Use Vault to store API keys, COS credentials, and KMS references; configure roles/policies to limit access and audit every access.
+- Forward Vault audit logs to a centralized SIEM or object store for retention, monitoring and incident investigation.
+- Rotate keys and root tokens periodically and maintain a documented recovery/unseal process.
+
+If you want, I can:
+- Produce a stricter CI variant that fails the PR if claim evidence checks fail (recommended after you have a stable orchestrator run).
+- Add a GitHub Action to automatically remove tracked temporary JSON outputs from staged commits (dangerous — needs operator review).
+
*** End Patch
*** End Patch
