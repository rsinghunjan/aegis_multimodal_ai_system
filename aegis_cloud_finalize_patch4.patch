*** Begin Patch
*** Add File: scripts/aws_finalize_and_verify.sh
+#!/usr/bin/env bash
+set -euo pipefail
+#
+# aws_finalize_and_verify.sh
+# Attach strict S3+KMS policies to IRSA role, tag resources for chargeback, trigger staging drill and verify restore.
+#
+# Usage:
+#   ./scripts/aws_finalize_and_verify.sh --bucket my-bucket --kms-arn arn:aws:kms:... --role my-irsa-role --tag cost-center=test --run-workflow local|gh
+#
+BUCKET=""
+KMS_ARN=""
+ROLE=""
+TAG=""
+RUN_WORKFLOW="local"
+AWS_REGION="${AWS_REGION:-}"
+
+while [ $# -gt 0 ]; do
+  case "$1" in
+    --bucket) BUCKET="$2"; shift 2;;
+    --kms-arn) KMS_ARN="$2"; shift 2;;
+    --role) ROLE="$2"; shift 2;;
+    --tag) TAG="$2"; shift 2;;
+    --run-workflow) RUN_WORKFLOW="$2"; shift 2;;
+    --region) AWS_REGION="$2"; shift 2;;
+    -h|--help) sed -n '1,120p' "$0"; exit 0;;
+    *) echo "Unknown arg: $1"; exit 2;;
+  esac
+done
+
+if [ -z "$BUCKET" ] || [ -z "$KMS_ARN" ] || [ -z "$ROLE" ]; then
+  echo "Missing required args --bucket --kms-arn --role"
+  exit 2
+fi
+
+echo "[aws] Preparing policy JSONs"
+mkdir -p /tmp/aegis-aws
+S3_POLICY_OUT="/tmp/aegis-aws/s3_policy.json"
+KMS_POLICY_OUT="/tmp/aegis-aws/kms_policy.json"
+sed "s|YOUR_MILVUS_BACKUP_BUCKET|${BUCKET}|g; s|arn:aws:kms:REGION:ACCOUNT_ID:key/REPLACE_ME_KEY_ID|${KMS_ARN}|g" infra/iam/aws/managed_policies/s3_backup_policy_prod_strict.json > "$S3_POLICY_OUT"
+sed "s|arn:aws:kms:REGION:ACCOUNT_ID:key/REPLACE_ME_KEY_ID|${KMS_ARN}|g" infra/iam/aws/managed_policies/kms_policy_prod_strict.json > "$KMS_POLICY_OUT"
+
+echo "[aws] Create or reuse managed policies"
+S3_POLICY_ARN=$(aws iam list-policies --scope Local --query "Policies[?PolicyName=='AegisS3BackupPolicy-${BUCKET}'].Arn | [0]" --output text || true)
+if [ -z "$S3_POLICY_ARN" ] || [ "$S3_POLICY_ARN" = "None" ]; then
+  S3_POLICY_ARN=$(aws iam create-policy --policy-name "AegisS3BackupPolicy-${BUCKET}" --policy-document file://"$S3_POLICY_OUT" --query Policy.Arn --output text)
+  echo "[aws] Created S3 policy: $S3_POLICY_ARN"
+else
+  echo "[aws] Found existing S3 policy: $S3_POLICY_ARN"
+fi
+
+KMS_POLICY_ARN=$(aws iam list-policies --scope Local --query "Policies[?PolicyName=='AegisKMSBackupPolicy-${ROLE}'].Arn | [0]" --output text || true)
+if [ -z "$KMS_POLICY_ARN" ] || [ "$KMS_POLICY_ARN" = "None" ]; then
+  KMS_POLICY_ARN=$(aws iam create-policy --policy-name "AegisKMSBackupPolicy-${ROLE}" --policy-document file://"$KMS_POLICY_OUT" --query Policy.Arn --output text)
+  echo "[aws] Created KMS policy: $KMS_POLICY_ARN"
+else
+  echo "[aws] Found existing KMS policy: $KMS_POLICY_ARN"
+fi
+
+echo "[aws] Attaching policies to role ${ROLE}"
+aws iam attach-role-policy --role-name "$ROLE" --policy-arn "$S3_POLICY_ARN" || true
+aws iam attach-role-policy --role-name "$ROLE" --policy-arn "$KMS_POLICY_ARN" || true
+
+if [ -n "$TAG" ]; then
+  echo "[aws] Tagging bucket and policies for chargeback: $TAG"
+  # Tag bucket
+  aws s3api put-bucket-tagging --bucket "$BUCKET" --tagging "TagSet=[{Key=${TAG%=*},Value=${TAG#*=}}]" || echo "[aws] warn: failed to tag bucket (check permissions)"
+  # Tag policies
+  aws iam tag-policy --policy-arn "$S3_POLICY_ARN" --tags Key="${TAG%=*}",Value="${TAG#*=}" || true
+  aws iam tag-policy --policy-arn "$KMS_POLICY_ARN" --tags Key="${TAG%=*}",Value="${TAG#*=}" || true
+fi
+
+echo "[aws] Triggering staging backup->restore drill"
+if [ "$RUN_WORKFLOW" = "gh" ]; then
+  if ! command -v gh >/dev/null 2>&1; then
+    echo "[aws] gh CLI not present; set --run-workflow local to run locally"
+    exit 1
+  fi
+  # Trigger the workflow that we created earlier
+  gh workflow run aws_staging_drill.yml --ref main || echo "[aws] Failed to dispatch GH workflow"
+else
+  chmod +x scripts/aws_backup_restore_drill.sh
+  # Expect STAGING_NAMESPACE, AWS_BACKUP_CRONJOB env / secrets to be set
+  ./scripts/aws_backup_restore_drill.sh --namespace "${STAGING_NAMESPACE:-aegis}" --backup-job "${AWS_BACKUP_CRONJOB:-aegis-milvus-backup}" --s3-bucket "$BUCKET"
+fi
+
+echo "[aws] Drill complete. Please check restore artifacts and application-level validation."
+
*** End Patch
*** Add File: scripts/azure_finalize_and_verify.sh
+#!/usr/bin/env bash
+set -euo pipefail
+#
+# azure_finalize_and_verify.sh
+# Detect pod-identity variant,
î€€
