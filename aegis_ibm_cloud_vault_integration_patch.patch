*** Begin Patch
*** Add File: terraform/ibm/terraform.tfvars.template
+ibm_region = "REPLACE_WITH_IBM_REGION"
+ibm_resource_group = "REPLACE_WITH_RESOURCE_GROUP"
+ibm_cos_bucket = "REPLACE_WITH_COS_BUCKET_NAME"
+github_repo = "REPLACE_WITH_GITHUB_OWNER/REPO"
+
+# Note: DO NOT store service API keys or other secrets in this file.
+# Use the scripts in scripts/ibm to create resources and push secrets into Vault.
+
*** End Patch
*** Begin Patch
*** Add File: terraform/ibm/README_IBMCLOUD.md
+# IBM Cloud Quickstart (Aegis)
+
+This directory contains templates and guidance to provision minimal IBM Cloud resources needed to run IBM Quantum (Qiskit) and store artifacts:
+- terraform.tfvars.template — placeholders to create a PR-ready variables file.
+
+We intentionally provide CLI-first helper scripts under scripts/ibm to create service IDs, API keys and COS buckets. After creating secrets, store them in Vault (see scripts/store_ibm_secrets_to_vault.sh) and use Vault Agent Injector to provide credentials to Kubernetes workloads.
+
+High-level steps
+1. Install and authenticate the ibmcloud CLI and required plugins (see scripts/ibm/setup_ibmcloud_cli.txt).
+2. Run scripts/ibm/create_ibm_resources.sh to create a service-id, API key, and optionally a COS bucket (the script prints a local JSON file with created metadata — do NOT commit).
+3. Run scripts/ibm/store_ibm_secrets_to_vault.sh to push secrets into Vault KV v2 at path secret/data/ibm/.
+4. Use the Vault Agent injector example in examples/vault/ibm/vault-k8s-vault-agent-inject-ibm-secret.yaml to inject IBM credentials into pods.
+5. Deploy quantum workers that read IBM credentials from Vault (recommended) and run Qiskit jobs.
+
+Security notes
+- Never commit API keys or tokens to git.
+- Use Vault to store IBM credentials and enable strict access policies.
+- Consider IBM Key Protect for KMS if you need HSM-backed keys and integrate with Vault where possible.
+
*** End Patch
*** Begin Patch
*** Add File: scripts/ibm/create_ibm_resources.sh
+#!/usr/bin/env bash
+set -euo pipefail
+#
+# Create minimal IBM Cloud resources using ibmcloud CLI:
+# - service-id for CI/workers
+# - API key for that service-id
+# - optionally Cloud Object Storage bucket for artifacts (requires COS plugin + entitlement)
+#
+# IMPORTANT: This script prints secrets to stdout for operator convenience; do NOT commit outputs.
+#
+OUT_DIR=${OUT_DIR:-./scripts/ibm/out}
+mkdir -p "$OUT_DIR"
+
+usage() {
+  cat <<EOF
+Usage: $0 --name <friendly-name> [--create-cos] [--region <region>] [--resource-group <rg>] [--output <outdir>]
+
+Creates:
+ - IBM Cloud service-id
+ - IBM Cloud API key for the service-id
+ - (optional) COS bucket
+
+Outputs a JSON file in $OUT_DIR with created resource info. Move API keys to Vault using scripts/store_ibm_secrets_to_vault.sh
+EOF
+}
+
+NAME=""
+CREATE_COS=false
+REGION="us-south"
+RESOURCE_GROUP=""
+OUT="$OUT_DIR/ibm_resources.json"
+
+while [[ $# -gt 0 ]]; do
+  case "$1" in
+    --name) NAME="$2"; shift 2;;
+    --create-cos) CREATE_COS=true; shift ;;
+    --region) REGION="$2"; shift 2;;
+    --resource-group) RESOURCE_GROUP="$2"; shift 2;;
+    --output) OUT="$2"; shift 2;;
+    -h|--help) usage; exit 0;;
+    *) echo "Unknown arg: $1"; usage; exit 2;;
+  esac
+done
+
+if [ -z "$NAME" ]; then
+  echo "You must supply --name"; usage; exit 2
+fi
+
+echo "Creating IBM Cloud service-id for: $NAME"
+# Ensure user is logged in with ibmcloud CLI
+if ! ibmcloud target > /dev/null 2>&1; then
+  echo "Please login with 'ibmcloud login' or 'ibmcloud login --sso' before running this script"
+  exit 2
+fi
+
+# Create service-id
+SID_JSON=$(ibmcloud iam service-id-create "$NAME" -d "Aegis generated service-id for $NAME" --output json)
+SID=$(echo "$SID_JSON" | jq -r '.id')
+SID_NAME=$(echo "$SID_JSON" | jq -r '.name')
+echo "Service ID created: $SID_NAME ($SID)"
+
+# Create API key for service-id
+AK_JSON=$(ibmcloud iam service-id-api-key-create "$SID" "${NAME}-key" -d "API key for $SID_NAME" --output json)
+APIKEY=$(echo "$AK_JSON" | jq -r '.apikey')
+APIKEY_ID=$(echo "$AK_JSON" | jq -r '.id')
+echo "API key created: id=$APIKEY_ID"
+
+COS_BUCKET=""
+if [ "$CREATE_COS" = true ]; then
+  echo "Creating Cloud Object Storage bucket (requires COS plugin and entitlement)"
+  if ! ibmcloud plugin list | grep -q cloud-object-storage; then
+    echo "Installing COS plugin..."
+    ibmcloud plugin install cloud-object-storage -f
+  fi
+  # region and resource group selection
+  if [ -z "$RESOURCE_GROUP" ]; then
+    RESOURCE_GROUP=$(ibmcloud resource groups | awk 'NR==4{print $2}')
+    echo "Detected resource-group: $RESOURCE_GROUP"
+  fi
+  # Create bucket using ibmcloud resource service-instance & cos CLI - this is environment specific; fallback prints note
+  echo "Creating COS bucket named ${NAME}-${REGION} (best-effort — check output)"
+  # Best-effort: user may need to create a service instance and use 'ibmcloud cos' commands
+  # Attempt to create using 'ibmcloud cos' if available
+  if ibmcloud cos version >/dev/null 2>&1; then
+    BUCKET_NAME="${NAME}-${REGION}"
+    ibmcloud cos create-bucket --bucket "$BUCKET_NAME" --region "$REGION"
+    COS_BUCKET="$BUCKET_NAME"
+    echo "COS bucket created: $COS_BUCKET"
+  else
+    echo "ibmcloud cos plugin not available or not configured; skipping COS creation. You can create a COS bucket manually."
+  fi
+fi
+
+cat > "$OUT" <<JSON
+{
+  "service_id": "$SID",
+  "service_id_name": "$SID_NAME",
+  "api_key_id": "$APIKEY_ID",
+  "api_key": "$APIKEY",
+  "cos_bucket": "$COS_BUCKET",
+  "region": "$REGION",
+  "resource_group": "$RESOURCE_GROUP"
+}
+JSON
+
+echo "Wrote resource info to $OUT"
+echo "NEXT: run scripts/ibm/store_ibm_secrets_to_vault.sh --input $OUT to store secrets in Vault (recommended)."
+
*** End Patch
*** Begin Patch
*** Add File: scripts/ibm/store_ibm_secrets_to_vault.sh
+#!/usr/bin/env bash
+set -euo pipefail
+#
+# Store IBM API key and metadata into Vault KV v2 at secret/data/ibm/
+# Usage:
+#   ./store_ibm_secrets_to_vault.sh --input ./scripts/ibm/out/ibm_resources.json --vault-path secret/data/ibm
+#
+INPUT=""
+VAULT_PATH=${VAULT_PATH:-secret/data/ibm}
+VAULT_CLI=${VAULT_CLI:-vault} # expects vault CLI in PATH and VAULT_ADDR/VAULT_TOKEN env set
+
+while [[ $# -gt 0 ]]; do
+  case "$1" in
+    --input) INPUT="$2"; shift 2;;
+    --vault-path) VAULT_PATH="$2"; shift 2;;
+    *) echo "Unknown arg: $1"; exit 2;;
+  esac
+done
+
+if [ -z "$INPUT" ]; then
+  echo "Usage: $0 --input <json-file> [--vault-path secret/data/ibm]"
+  exit 2
+fi
+
+if [ ! -f "$INPUT" ]; then
+  echo "Input file not found: $INPUT"
+  exit 2
+fi
+
+if ! command -v "$VAULT_CLI" >/dev/null 2>&1; then
+  echo "Vault CLI ($VAULT_CLI) not found. Install it and ensure VAULT_ADDR and VAULT_TOKEN env vars are set."
+  exit 2
+fi
+
+JSON=$(cat "$INPUT")
+APIKEY=$(echo "$JSON" | jq -r '.api_key')
+APIKEY_ID=$(echo "$JSON" | jq -r '.api_key_id')
+SID=$(echo "$JSON" | jq -r '.service_id')
+REGION=$(echo "$JSON" | jq -r '.region')
+COS_BUCKET=$(echo "$JSON" | jq -r '.cos_bucket')
+
+echo "Storing IBM credentials to Vault path: $VAULT_PATH (write will be recorded in Vault audit logs)"
+$VAULT_CLI kv put "${VAULT_PATH#secret/data/}" api_key="$APIKEY" api_key_id="$APIKEY_ID" service_id="$SID" region="$REGION" cos_bucket="$COS_BUCKET"
+
+echo "Stored IBM credentials in Vault. Verify with: vault kv get ${VAULT_PATH#secret/data/}"
+echo "REMINDER: Remove the local JSON file containing the API key after verification: rm -f $INPUT"
+
*** End Patch
*** Begin Patch
*** Add File: examples/vault/ibm/vault-k8s-vault-agent-inject-ibm-secret.yaml
+apiVersion: v1
+kind: Pod
+metadata:
+  name: ibm-client-example
+  labels:
+    app: ibm-client
+  annotations:
+    # Example Vault Agent Injector annotation - adjust per your Vault setup
+    vault.hashicorp.com/agent-inject: "true"
+    vault.hashicorp.com/role: "aegis-ibm-client-role"
+    vault.hashicorp.com/agent-inject-secret-ibm: "secret/data/ibm"
+    vault.hashicorp.com/agent-inject-template-ibm: |
+      {{- with secret "secret/data/ibm" -}}
+      export IBM_API_KEY="{{ .Data.data.api_key }}"
+      export IBM_API_KEY_ID="{{ .Data.data.api_key_id }}"
+      export IBM_REGION="{{ .Data.data.region }}"
+      export IBM_COS_BUCKET="{{ .Data.data.cos_bucket }}"
+      {{- end -}}
+spec:
+  serviceAccountName: default
+  containers:
+  - name: ibm-client
+    image: curlimages/curl:latest
+    command: ["/bin/sh","-c","env | grep IBM || sleep 3600"]
+
+---
+# Notes:
+# - This Pod uses the Vault Agent Injector to write env variables into a file sourced by the container.
+# - Configure the Vault role 'aegis-ibm-client-role' to allow read access to secret/data/ibm.
+
*** End Patch
*** Begin Patch
*** Add File: docs/ibm_integration.md
+# IBM Cloud Integration for Aegis (Detailed)
+
+This document shows step-by-step instructions to integrate IBM Cloud resources and IBM Quantum credentials into Aegis securely using Vault.
+
+1) Prerequisites
+- ibmcloud CLI installed and logged-in (ibmcloud login).
+- Vault installed and accessible (VAULT_ADDR & VAULT_TOKEN available to operator).
+- jq and vault CLI installed locally for scripts.
+
+2) Create resources (service-id + API key + optional COS bucket)
+- Run:
+  ./scripts/ibm/create_ibm_resources.sh --name aegis-quantum-ci --create-cos --region us-south --resource-group Default
+- Review the generated file: scripts/ibm/out/ibm_resources.json
+- IMPORTANT: Remove or secure this file after use.
+
+3) Store secrets to Vault
+- Run:
+  ./scripts/ibm/store_ibm_secrets_to_vault.sh --input scripts/ibm/out/ibm_resources.json
+- Verify:
+  vault kv get secret/ibm
+
+4) Configure Kubernetes workloads to use Vault Agent Injector
+- Install Vault Agent Injector (if not already installed).
+- Create a Vault role binding that allows the Kubernetes service account to read secret/data/ibm (refer to Vault docs).
+- Use the example manifest examples/vault/ibm/vault-k8s-vault-agent-inject-ibm-secret.yaml and adjust role names.
+
+5) Update quantum workers
+- Deploy or update quantum worker Deployment to use Vault-injected env vars.
+- Ensure workers run with least privileged service account and cannot access other secrets.
+
+6) CI integration
+- Prefer OIDC -> Vault role binding for GitHub Actions to obtain short-lived Vault tokens rather than storing IBM API keys in GitHub secrets.
+- If OIDC not possible, store IBM credentials in Vault and allow CI to request them at runtime.
+
+7) Running Qiskit jobs securely
+- Workers/Controllers read IBM API key from Vault and pass to qiskit-ibm-runtime via environment variables or in-memory config.
+- Always sign circuit snapshots and log provenance (MLflow + Rekor) for reproducibility and audit.
+
+8) Optional: Terraform automation
+- You can convert CLI steps to Terraform (IBM Cloud Provider) after validating the CLI flows in your account. Contact me if you want a Terraform module generated.
+
*** End Patch
*** Begin Patch
*** Add File: scripts/ibm/setup_ibmcloud_cli.txt
+IBM Cloud CLI Setup Notes
+
+1) Install ibmcloud CLI:
+   https://cloud.ibm.com/docs/cli?topic=cli-install-ibmcloud-cli
+
+2) Install plugins you may need:
+   ibmcloud plugin install resource-manager
+   ibmcloud plugin install cloud-object-storage
+   ibmcloud plugin install iam
+
+3) Login:
+   ibmcloud login --sso
+   # or interactive:
+   ibmcloud login
+
+4) Set target:
+   ibmcloud target -r ${REGION}
+   ibmcloud target -g ${RESOURCE_GROUP}
+
+5) Use `ibmcloud iam` for service-id and API key operations, and `ibmcloud cos` for Cloud Object Storage operations.
+
*** End Patch
*** Begin Patch
*** Add File: security_notes/ibm_key_protect_notes.md
+# IBM Key Protect (KMS) Notes and Recommendations
+
+Overview
+- IBM Key Protect provides KMS capabilities on IBM Cloud, including managed encryption keys. For high-assurance signing keys you can use Key Protect as a backing store or integrate with HashiCorp Vault.
+
+Recommendations for production
+1. Use Vault as the central signing abstraction:
+   - Keep Vault HA in your control plane and use Key Protect as a seal or as an HSM backing if required.
+   - Vault transit can hold short-lived signing keys and rotate them while Key Protect stores root material if policy requires.
+2. Avoid embedding Key Protect credentials in pods:
+   - Store Key Protect API keys in Vault and inject them via Vault Agent when needed.
+3. Audit & rotation:
+   - Enable Key Protect rotation policies where available. Ensure Vault audit logs and Key Protect access logs are collected to your compliance bucket.
+4. Integration tips:
+   - Test Key Protect KMS operations (sign/verify) in a staging account before production.
+   - If you need cosign integration with IBM Key Protect, consider using Vault as a bridge: cosign -> Vault transit -> Key Protect backing.
+
+Limitations
+- IBM Cloud's KMS/Key Protect APIs and Terraform support may vary by region and account. Validate via CLI before fully automating with Terraform.
+
*** End Patch
*** End Patch
