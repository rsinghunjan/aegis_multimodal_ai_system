*** Begin Patch
*** Add File:quantum/README_QUANTUM_INTEGRATION.md
+Quantum integrations (IBM Qiskit Runtime + AWS Braket)
+====================================================
+
+What this folder contains
+- qiskit_adapter.py — adapter to submit simple circuits to IBM Q (Qiskit Runtime) or simulate locally.
+- braket_adapter.py — adapter to submit simple circuits to AWS Braket or simulate locally.
+- job_manifests/ — Kubernetes Job manifests to run adapters in-cluster (referencing secrets).
+- ci/mock_quantum_ci.yml — GitHub Actions workflow to run adapters in mocked mode (no credentials).
+- rekor_log_best_effort.sh — optional script to log metadata to a Rekor-compatible server (best-effort).
+
+Design goals
+- Provide end-to-end examples that:
+  - submit a circuit/job to a provider (or run in mock/simulator mode)
+  - poll for completion
+  - upload job metadata and results to evidence S3 (path: quantum/<provider>/<job-id>.json)
+  - optionally POST a small Rekor/log entry (best-effort)
+- Keep credentials out of code: adapter reads provider credentials from environment variables or mounted Kubernetes secrets.
+- Support mock/simulated mode to allow CI runs without cloud credentials.
+
+Prereqs for real runs
+- For IBM Qiskit Runtime:
+  - qiskit-ibm-runtime installed in image
+  - environment variables: QISKIT_API_TOKEN, QISKIT_INSTANCE (optional), EVIDENCE_BUCKET, AWS_REGION
+
+- For AWS Braket:
+  - braket-sdk (amazon-braket-sdk) installed or AWS CLI + boto3
+  - AWS credentials available (instance role or env): AWS_ACCESS_KEY_ID / AWS_SECRET_ACCESS_KEY or IAM role
+  - BRAKET_DEVICE_ARN or BRAKET_DEVICE (e.g., "arn:aws:braket:us-west-1::device/quantum-simulator/amazon/sv1")
+  - EVIDENCE_BUCKET, AWS_REGION
+
+Mock CI
+- The supplied GitHub Action runs adapters in MOCK_QUANTUM=1 mode (simulates results) so CI can validate control flow without secrets.
+
+Security & auditing
+- Adapters write metadata to s3://<EVIDENCE_BUCKET>/quantum/<provider>/ and optionally attempt to POST a small record to a Rekor endpoint if REKOR_URL is provided.
+- Do NOT embed provider credentials in the repo. Use ExternalSecrets / SecretsManager and mount into Jobs / Pods.
+
+Run locally (mock)
+- export MOCK_QUANTUM=1 EVIDENCE_BUCKET=REPLACE_WITH_EVIDENCE_BUCKET AWS_REGION=us-west-2
+- python3 quantum/qiskit_adapter.py
+- python3 quantum/braket_adapter.py
+
+Run in-cluster
+- Create Kubernetes Secret with provider credentials and apply the job manifests in job_manifests/.
+
+Notes
+- The adapters attempt to import provider SDKs; if the SDK is not available they fall back to simulation mode (but require MOCK_QUANTUM=1 to run in CI).
+- This integration is meant to be operator-reviewed: update device names and instance identifiers for your provider before running against real hardware.
+
*** End Patch
*** Begin Patch
*** Add File:quantum/qiskit_adapter.py
+#!/usr/bin/env python3
+"""
+Adapter for IBM Qiskit Runtime (best-effort + mock).
+
+Behavior:
+ - If MOCK_QUANTUM=1: generate a simulated result and upload to S3.
+ - Else: try to use qiskit_ibm_runtime to submit a simple circuit and poll for result.
+ - Upload metadata and result to s3://<EVIDENCE_BUCKET>/quantum/qiskit/<job_id>.json
+ - Optionally POST a small Rekor/log entry to REKOR_URL if provided (best-effort).
+
+Environment variables:
+ - MOCK_QUANTUM=1 (optional)
+ - QISKIT_API_TOKEN, QISKIT_INSTANCE (optional)
+ - EVIDENCE_BUCKET, AWS_REGION
+ - REKOR_URL (optional)
+"""
+import os
+import time
+import json
+import tempfile
+import traceback
+from datetime import datetime
+
+MOCK = os.environ.get("MOCK_QUANTUM", "") == "1"
+EVIDENCE_BUCKET = os.environ.get("EVIDENCE_BUCKET", "REPLACE_WITH_EVIDENCE_BUCKET")
+AWS_REGION = os.environ.get("AWS_REGION", "us-west-2")
+REKOR_URL = os.environ.get("REKOR_URL", "")
+
+def upload_to_s3(s3, key, data):
+    s3.put_object(Bucket=EVIDENCE_BUCKET, Key=key, Body=json.dumps(data).encode())
+    return f"s3://{EVIDENCE_BUCKET}/{key}"
+
+def post_rekor(note):
+    if not REKOR_URL:
+        return False
+    try:
+        import requests
+        requests.post(REKOR_URL + "/api/v1/log/entries", json=note, timeout=10)
+        return True
+    except Exception:
+        return False
+
+def run_mock():
+    # create fake job id and result
+    job_id = f"mock-qiskit-{int(time.time())}"
+    result = {"job_id": job_id, "provider": "mock-qiskit", "status": "COMPLETED", "counts": {"00": 512, "11": 512}, "ts": datetime.utcnow().isoformat()+"Z"}
+    # upload
+    import boto3
+    s3 = boto3.client("s3", region_name=AWS_REGION)
+    key = f"quantum/qiskit/{job_id}.json"
+    uri = upload_to_s3(s3, key, result)
+    print("Uploaded mocked result to", uri)
+    post_rekor({"type":"quantum_job","provider":"qiskit","job_id":job_id,"s3":uri})
+
+def run_qiskit():
+    # Try to import qiskit_ibm_runtime; if not available, advise install.
+    try:
+        from qiskit_ibm_runtime import QiskitRuntimeService, Sampler
+        from qiskit import QuantumCircuit
+    except Exception as e:
+        print("qiskit_ibm_runtime not available or import failed:", e)
+        print("Set MOCK_QUANTUM=1 to run in mock mode or install qiskit-ibm-runtime.")
+        raise
+
+    token = os.environ.get("QISKIT_API_TOKEN")
+    instance = os.environ.get("QISKIT_INSTANCE", None)
+    if not token:
+        raise SystemExit("QISKIT_API_TOKEN required for real IBM submission")
+
+    # Build a small Bell circuit
+    qc = QuantumCircuit(2)
+    qc.h(0)
+    qc.cx(0,1)
+    qc.measure_all()
+
+    service = QiskitRuntimeService(channel="cloud", token=token, instance=instance) if instance else QiskitRuntimeService(channel="cloud", token=token)
+    # Use the Sampler primitive where available (some runtimes use 'sampler' primitive)
+    sampler = Sampler(session=service)
+    print("Submitting job to Qiskit runtime (primitive sampler)...")
+    job = sampler.run(circuits=qc, shots=1024)
+    job_id = getattr(job, "id", f"qiskit-{int(time.time())}")
+    print("Submitted job id:", job_id)
+    # poll for results (job.result() will block until ready)
+    res = job.result()
+    counts = res.quasi_probabilities() if hasattr(res, "quasi_probabilities") else res.get_counts()
+
+    out = {"job_id": job_id, "provider": "qiskit", "status": "COMPLETED", "counts": counts, "ts": datetime.utcnow().isoformat()+"Z"}
+    import boto3
+    s3 = boto3.client("s3", region_name=AWS_REGION)
+    key = f"quantum/qiskit/{job_id}.json"
+    uri = upload_to_s3(s3, key, out)
+    print("Uploaded result to", uri)
+    post_rekor({"type":"quantum_job","provider":"qiskit","job_id":job_id,"s3":uri})
+
+def main():
+    try:
+        if MOCK:
+            run_mock()
+        else:
+            run_qiskit()
+    except Exception:
+        traceback.print_exc()
+        # as best-effort, if real submission fails, create failure record in S3
+        import boto3
+        s3 = boto3.client("s3", region_name=AWS_REGION)
+        job_id = f"qiskit-failed-{int(time.time())}"
+        out = {"job_id": job_id, "provider": "qiskit", "status": "FAILED", "error": traceback.format_exc(), "ts": datetime.utcnow().isoformat()+"Z"}
+        key = f"quantum/qiskit/{job_id}.json"
+        upload_to_s3(s3, key, out)
+        print("Wrote failure artifact to", f"s3://{EVIDENCE_BUCKET}/{key}")
+
+if __name__ == "__main__":
+    main()
+
*** End Patch
*** Begin Patch
*** Add File:quantum/braket_adapter.py
+#!/usr/bin/env python3
+"""
+Adapter for AWS Braket (best-effort + mock).
+
+Behavior:
+ - If MOCK_QUANTUM=1: generate a simulated result and upload to S3.
+ - Else: use braket SDK to submit a small circuit to the device ARN provided.
+ - Upload job metadata/results to s3://<EVIDENCE_BUCKET>/quantum/braket/<task-id>.json
+ - Optionally POST a small Rekor/log entry to REKOR_URL if provided (best-effort).
+
+Environment variables:
+ - MOCK_QUANTUM=1 (optional)
+ - BRAKET_DEVICE_ARN or BRAKET_DEVICE
+ - EVIDENCE_BUCKET, AWS_REGION
+ - REKOR_URL (optional)
+"""
+import os, time, json, traceback
+from datetime import datetime
+
+MOCK = os.environ.get("MOCK_QUANTUM", "") == "1"
+EVIDENCE_BUCKET = os.environ.get("EVIDENCE_BUCKET", "REPLACE_WITH_EVIDENCE_BUCKET")
+AWS_REGION = os.environ.get("AWS_REGION", "us-west-2")
+REKOR_URL = os.environ.get("REKOR_URL", "")
+
+def upload_to_s3(s3, key, data):
+    s3.put_object(Bucket=EVIDENCE_BUCKET, Key=key, Body=json.dumps(data).encode())
+    return f"s3://{EVIDENCE_BUCKET}/{key}"
+
+def post_rekor(note):
+    if not REKOR_URL:
+        return False
+    try:
+        import requests
+        requests.post(REKOR_URL + "/api/v1/log/entries", json=note, timeout=10)
+        return True
+    except Exception:
+        return False
+
+def run_mock():
+    task_id = f"mock-braket-{int(time.time())}"
+    result = {"task_id": task_id, "provider": "mock-braket", "status": "COMPLETED", "counts": {"0": 1024}, "ts": datetime.utcnow().isoformat()+"Z"}
+    import boto3
+    s3 = boto3.client("s3", region_name=AWS_REGION)
+    key = f"quantum/braket/{task_id}.json"
+    upload_to_s3(s3, key, result)
+    print("Uploaded mocked result to s3://%s/%s" % (EVIDENCE_BUCKET, key))
+    post_rekor({"type":"quantum_job","provider":"braket","task_id":task_id,"s3":f"s3://{EVIDENCE_BUCKET}/{key}"})
+
+def run_braket():
+    # Attempt to import Braket SDK
+    try:
+        from braket.aws import AwsDevice
+        from braket.circuits import Circuit
+        import boto3
+    except Exception as e:
+        print("braket SDK not available or import failed:", e)
+        print("Install amazon-braket-sdk or set MOCK_QUANTUM=1 for mock runs.")
+        raise
+
+    device_arn = os.environ.get("BRAKET_DEVICE_ARN") or os.environ.get("BRAKET_DEVICE")
+    if not device_arn:
+        raise SystemExit("BRAKET_DEVICE_ARN required for real Braket submission")
+
+    device = AwsDevice(device_arn)
+    # Build a simple circuit: single qubit X then measure (many providers require specific instruction sets)
+    circ = Circuit().x(0).measure(0)
+    print("Submitting circuit to Braket device:", device_arn)
+    task = device.run(circ, shots=1000)
+    task_id = task.id
+    print("Submitted task id:", task_id)
+    # Poll for completion
+    status = task.state().value
+    print("Initial state:", status)
+    while status not in ("COMPLETED","FAILED","CANCELLED"):
+        time.sleep(5)
+        status = task.state().value
+        print("State:", status)
+    if status != "COMPLETED":
+        raise SystemExit("Braket task did not complete successfully: " + status)
+    result = task.result()
+    # result measurement counts vary by SDK; try to extract counts if present
+    counts = {}
+    try:
+        for r in result.measurement_counts:
+            counts.update(r)
+    except Exception:
+        # fallback: store raw result
+        counts = str(result)
+
+    out = {"task_id": task_id, "provider": "braket", "status": "COMPLETED", "counts": counts, "ts": datetime.utcnow().isoformat()+"Z"}
+    s3 = boto3.client("s3", region_name=AWS_REGION)
+    key = f"quantum/braket/{task_id}.json"
+    upload_to_s3(s3, key, out)
+    print("Uploaded result to s3://%s/%s" % (EVIDENCE_BUCKET, key))
+    post_rekor({"type":"quantum_job","provider":"braket","task_id":task_id,"s3":f"s3://{EVIDENCE_BUCKET}/{key}"})
+
+def main():
+    try:
+        if MOCK:
+            run_mock()
+        else:
+            run_braket()
+    except Exception:
+        traceback.print_exc()
+        import boto3
+        s3 = boto3.client("s3", region_name=AWS_REGION)
+        task_id = f"braket-failed-{int(time.time())}"
+        out = {"task_id": task_id, "provider": "braket", "status": "FAILED", "error": traceback.format_exc(), "ts": datetime.utcnow().isoformat()+"Z"}
+        key = f"quantum/braket/{task_id}.json"
+        upload_to_s3(s3, key, out)
+        print("Wrote failure artifact to s3://%s/%s" % (EVIDENCE_BUCKET, key))
+
+if __name__ == "__main__":
+    main()
+
*** End Patch
*** Begin Patch
*** Add File:quantum/job_manifests/qiskit_job.yaml
+apiVersion: batch/v1
+kind: Job
+metadata:
+  name: aegis-quantum-qiskit-job
+  namespace: aegis
+spec:
+  template:
+    spec:
+      serviceAccountName: aegis-quantum-sa
+      containers:
+        - name: qiskit-adapter
+          image: ghcr.io/yourorg/aegis-quantum-adapter:latest
+          env:
+            - name: EVIDENCE_BUCKET
+              value: "REPLACE_WITH_EVIDENCE_BUCKET"
+            - name: AWS_REGION
+              value: "REPLACE_WITH_AWS_REGION"
+            - name: QISKIT_API_TOKEN
+              valueFrom:
+                secretKeyRef:
+                  name: quantum-creds
+                  key: QISKIT_API_TOKEN
+            - name: QISKIT_INSTANCE
+              valueFrom:
+                secretKeyRef:
+                  name: quantum-creds
+                  key: QISKIT_INSTANCE
+            - name: REKOR_URL
+              valueFrom:
+                secretKeyRef:
+                  name: quantum-creds
+                  key: REKOR_URL
+          command: ["/bin/sh","-c"]
+          args:
+            - python3 /opt/quantum/qiskit_adapter.py
+      restartPolicy: Never
+  backoffLimit: 0
+
*** End Patch
*** Begin Patch
*** Add File:quantum/job_manifests/braket_job.yaml
+apiVersion: batch/v1
+kind: Job
+metadata:
+  name: aegis-quantum-braket-job
+  namespace: aegis
+spec:
+  template:
+    spec:
+      serviceAccountName: aegis-quantum-sa
+      containers:
+        - name: braket-adapter
+          image: ghcr.io/yourorg/aegis-quantum-adapter:latest
+          env:
+            - name: EVIDENCE_BUCKET
+              value: "REPLACE_WITH_EVIDENCE_BUCKET"
+            - name: AWS_REGION
+              value: "REPLACE_WITH_AWS_REGION"
+            - name: BRAKET_DEVICE_ARN
+              valueFrom:
+                secretKeyRef:
+                  name: quantum-creds
+                  key: BRAKET_DEVICE_ARN
+            - name: REKOR_URL
+              valueFrom:
+                secretKeyRef:
+                  name: quantum-creds
+                  key: REKOR_URL
+          command: ["/bin/sh","-c"]
+          args:
+            - python3 /opt/quantum/braket_adapter.py
+      restartPolicy: Never
+  backoffLimit: 0
+
*** End Patch
*** Begin Patch
*** Add File:quantum/rekor_log_best_effort.sh
+#!/usr/bin/env bash
+#
+# Best-effort Rekor POST helper for quantum adapters.
+# Usage: ./rekor_log_best_effort.sh <rekor_url> <json_file>
+#
+set -euo pipefail
+if [ $# -lt 2 ]; then
+  echo "Usage: $0 <rekor_url> <json_file>"
+  exit 2
+fi
+REKOR_URL=$1
+JSON=$2
+
+if command -v curl >/dev/null 2>&1; then
+  curl -s -X POST -H "Content-Type: application/json" --data-binary "@${JSON}" ${REKOR_URL}/api/v1/log/entries || echo "Rekor POST failed (best-effort)"
+else
+  echo "curl not found; cannot post to rekor"
+fi
+
*** End Patch
*** Begin Patch
*** Add File:quantum/ci/mock_quantum_ci.yml
+name: Quantum Adapters CI (mocked)
+
+on:
+  workflow_dispatch:
+
+env:
+  EVIDENCE_BUCKET: ${{ secrets.EVIDENCE_BUCKET }}
+  AWS_REGION: ${{ secrets.AWS_REGION }}
+
+jobs:
+  run-mock-adapters:
+    runs-on: ubuntu-latest
+    steps:
+      - uses: actions/checkout@v4
+      - name: Setup Python
+        uses: actions/setup-python@v4
+        with:
+          python-version: '3.11'
+      - name: Install deps (mock)
+        run: pip install boto3 requests
+      - name: Run Qiskit adapter in mock mode
+        env:
+          MOCK_QUANTUM: "1"
+          EVIDENCE_BUCKET: ${{ secrets.EVIDENCE_BUCKET }}
+          AWS_REGION: ${{ secrets.AWS_REGION }}
+        run: |
+          python3 quantum/qiskit_adapter.py
+      - name: Run Braket adapter in mock mode
+        env:
+          MOCK_QUANTUM: "1"
+          EVIDENCE_BUCKET: ${{ secrets.EVIDENCE_BUCKET }}
+          AWS_REGION: ${{ secrets.AWS_REGION }}
+        run: |
+          python3 quantum/braket_adapter.py
+
*** End Patch
*** End Patch
