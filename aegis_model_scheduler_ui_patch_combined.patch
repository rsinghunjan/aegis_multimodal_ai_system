*** Begin Patch
*** Add File: model/model_auto_rollback_cronjob.yaml
+apiVersion: batch/v1
+kind: CronJob
+metadata:
+  name: aegis-model-auto-rollback
+  namespace: aegis
+spec:
+  schedule: "*/15 * * * *" # every 15 minutes
+  jobTemplate:
+    spec:
+      template:
+        spec:
+          containers:
+            - name: auto-rollback
+              image: python:3.10-slim
+              env:
+                - name: COMPLIANCE_BUCKET
+                  valueFrom:
+                    secretKeyRef:
+                      name: aegis-secrets
+                      key: compliance-bucket
+                - name: REGION
+                  value: "US"
+                - name: MODEL_REGISTRY_API
+                  valueFrom:
+                    secretKeyRef:
+                      name: aegis-secrets
+                      key: model-registry-api
+                - name: MAE_MULTIPLIER
+                  value: "1.2"
+              command: ["/bin/sh", "-c"]
+              args:
+                - pip install boto3 requests >/dev/null 2>&1 || true; python /opt/scripts/model_promotion_monitor.py --region ${REGION} --minutes 10 --mae-mult ${MAE_MULTIPLIER}
+              volumeMounts:
+                - name: scripts
+                  mountPath: /opt/scripts
+          restartPolicy: OnFailure
+          volumes:
+            - name: scripts
+              configMap:
+                name: aegis-model-scripts
+
*** End Patch
*** Begin Patch
*** Add File: scheduler/k8s/redis_consumer_deployment.yaml
+apiVersion: apps/v1
+kind: Deployment
+metadata:
+  name: aegis-redis-queue-consumer
+  namespace: aegis
+spec:
+  replicas: 2
+  selector:
+    matchLabels:
+      app: aegis-redis-queue-consumer
+  template:
+    metadata:
+      labels:
+        app: aegis-redis-queue-consumer
+    spec:
+      serviceAccountName: aegis-queue
+      containers:
+        - name: redis-consumer
+          image: aegis/redis-consumer:latest
+          env:
+            - name: REDIS_URL
+              value: "redis://redis.aegis.svc:6379/0"
+            - name: SCHEDULER_ADAPTER_URL
+              value: "http://scheduler-adapter.aegis.svc:8200/schedule"
+            - name: METRICS_PORT
+              value: "9103"
+          ports:
+            - containerPort: 9103
+              name: metrics
+
*** End Patch
*** Begin Patch
*** Add File: scheduler/k8s/servicemonitor-redis-consumer.yaml
+apiVersion: monitoring.coreos.com/v1
+kind: ServiceMonitor
+metadata:
+  name: aegis-redis-consumer
+  namespace: monitoring
+spec:
+  selector:
+    matchLabels:
+      app: aegis-redis-queue-consumer
+  namespaceSelector:
+    any: true
+  endpoints:
+    - port: metrics
+      interval: 15s
+      path: /metrics
+
*** End Patch
*** Begin Patch
*** Add File: grafana/redis_queue_dashboard.json
+{
+  "title": "Aegis Scheduler Queue (Redis ZSET)",
+  "panels": [
+    {
+      "type": "stat",
+      "title": "Queue Length",
+      "targets": [{"expr": "aegis_queue_length"}]
+    },
+    {
+      "type": "graph",
+      "title": "Processed / Requeued",
+      "targets": [
+        {"expr": "increase(aegis_queue_processed_total[5m])", "legendFormat": "processed"},
+        {"expr": "increase(aegis_queue_requeued_total[5m])", "legendFormat": "requeued"}
+      ]
+    },
+    {
+      "type": "graph",
+      "title": "Throttle events",
+      "targets": [{"expr": "increase(aegis_queue_throttled_total[5m])"}]
+    },
+    {
+      "type": "graph",
+      "title": "Queue Length Over Time",
+      "targets": [{"expr": "aegis_queue_length"}]
+    }
+  ]
+}
+
*** End Patch
*** Begin Patch
*** Add File: scheduler/load_test_report_generator.py
+#!/usr/bin/env python3
+"""
+Generate a human-readable markdown load test report from /tmp/stress_results.json
+Fills in the load_test_report_template.md structure and uploads to COMPLIANCE_BUCKET if configured.
+"""
+import os, json, statistics, boto3
+from datetime import datetime
+
+RESULTS_FILE = os.environ.get("STRESS_RESULTS", "/tmp/stress_results.json")
+TEMPLATE = "docs/load_test_report_template.md"
+OUT_MD = f"/tmp/load_test_report_{datetime.utcnow().strftime('%Y%m%dT%H%M%SZ')}.md"
+COMPLIANCE_BUCKET = os.environ.get("COMPLIANCE_BUCKET")
+
+def synthesize():
+    if not os.path.exists(RESULTS_FILE):
+        print("No results file:", RESULTS_FILE); return
+    data = json.load(open(RESULTS_FILE))
+    total = len(data)
+    success = sum(1 for r in data if isinstance(r.get('status'), int) and 200 <= r['status'] < 300)
+    throttles = sum(1 for r in data if r.get('status') == 429)
+    errors = sum(1 for r in data if r.get('status') == 'error' or (isinstance(r.get('status'), int) and r['status'] >= 500))
+    latencies = [r.get('latency') for r in data if isinstance(r.get('latency'), (int,float))]
+    avg_latency = statistics.mean(latencies) if latencies else None
+    p95 = (sorted(latencies)[int(0.95*len(latencies))-1] if latencies and len(latencies)>=1 else None)
+    max_queue = None
+
+    md = []
+    md.append("# Scheduler Load Test Report")
+    md.append(f"**Date:** {datetime.utcnow().isoformat()}")
+    md.append(f"**Total requests:** {total}")
+    md.append(f"**Successful schedules:** {success}")
+    md.append(f"**Throttles (429):** {throttles}")
+    md.append(f"**Errors:** {errors}")
+    md.append(f"**Average latency (s):** {avg_latency}")
+    md.append(f"**P95 latency (s):** {p95}")
+    md.append("\n## Observations\n\n- Attach raw /tmp/stress_results.json for details.\n")
+    open(OUT_MD,"w").write("\n\n".join(md))
+    print("Wrote report", OUT_MD)
+    if COMPLIANCE_BUCKET:
+        s3 = boto3.client("s3")
+        key = f"load_tests/{os.path.basename(OUT_MD)}"
+        s3.upload_file(OUT_MD, COMPLIANCE_BUCKET, key)
+        print("Uploaded to s3://{}/{}".format(COMPLIANCE_BUCKET, key))
+
+if __name__=="__main__":
+    synthesize()
+
*** End Patch
*** Begin Patch
*** Add File: .github/workflows/scheduler_load_test_and_report_generate.yml
+name: Scheduler Load Test & Generate Report
+on:
+  workflow_dispatch:
+    inputs:
+      num_jobs:
+        default: "500"
+      concurrency:
+        default: "50"
+
+jobs:
+  run-and-generate:
+    runs-on: ubuntu-latest
+    steps:
+      - uses: actions/checkout@v4
+      - name: Install deps
+        run: pip install requests redis boto3
+      - name: Generate load and run stress test
+        env:
+          NUM_JOBS: ${{ github.event.inputs.num_jobs }}
+          CONCURRENCY: ${{ github.event.inputs.concurrency }}
+          ADMISSION_URL: ${{ secrets.ADMISSION_URL }}
+          SCHEDULER_SUBMIT: ${{ secrets.SCHEDULER_SUBMIT }}
+        run: |
+          python scheduler/load_test_scenarios.py
+          python scheduler/stress_test_runner.py
+      - name: Generate human-readable report
+        env:
+          COMPLIANCE_BUCKET: ${{ secrets.COMPLIANCE_BUCKET }}
+        run: python scheduler/load_test_report_generator.py
+      - name: Upload artifacts
+        uses: actions/upload-artifact@v4
+        with:
+          name: load-test-artifacts
+          path: |
+            /tmp/stress_results.json
+            /tmp/load_test_report_*.md
+
*** End Patch
*** Begin Patch
*** Add File: tenant-ui/src/TimeSeriesChart.js
+import React, {useEffect, useRef} from 'react';
+import { Line } from 'react-chartjs-2';
+import 'chartjs-adapter-date-fns';
+
+function TimeSeriesChart({region='US', hours=48}) {
+  const [data, setData] = React.useState(null);
+
+  useEffect(()=>{
+    fetch(`/forecast?region=${region}&hours=${hours}`).then(r=>r.json()).then(j=>{
+      const fc = j.forecast || [];
+      const labels = fc.map(e=>e.ts);
+      const pred = fc.map(e=>e.pred);
+      const lower = fc.map(e=>e.lower);
+      const upper = fc.map(e=>e.upper);
+      setData({
+        labels,
+        datasets: [
+          { label: 'Prediction', data: pred, borderColor: '#1976d2', fill: false },
+          { label: 'Lower', data: lower, borderColor: '#90caf9', borderDash: [5,5], fill: '+1' },
+          { label: 'Upper', data: upper, borderColor: '#f48fb1', borderDash: [5,5], fill: false }
+        ]
+      });
+    }).catch(()=>setData(null));
+  },[region,hours]);
+
+  if(!data) return <div>Loading forecast...</div>;
+  return <div style={{width: '100%', height: 300}}><Line data={data} /></div>;
+}
+
+export default TimeSeriesChart;
+
*** End Patch
*** Begin Patch
*** Add File: tenant-ui/src/WhatIf.js
+import React, {useState} from 'react';
+import axios from 'axios';
+
+function WhatIf({tenant}) {
+  const [estKg, setEstKg] = useState(1.0);
+  const [options, setOptions] = useState(null);
+  const [token, setToken] = useState(localStorage.getItem('aegis_token'));
+
+  const simulate = async () => {
+    try {
+      const resp = await axios.post(`/recommend/${tenant}`, {estimated_kgco2e: estKg, flexible: true}, {headers: token ? {Authorization: 'Bearer '+token} : {}});
+      setOptions(resp.data.recommendation ? [resp.data.recommendation] : []);
+    } catch(e) {
+      setOptions([{error: e.message}]);
+    }
+  };
+
+  return (
+    <div style={{marginTop:20}}>
+      <h3>Whatâ€‘If: Defer Simulation</h3>
+      <div>
+        <label>Estimated kgCO2e: <input type="number" value={estKg} onChange={e=>setEstKg(parseFloat(e.target.value))} /></label>
+        <button onClick={simulate}>Simulate</button>
+      </div>
+      <div>
+        {options && options.map((o,i)=>(<pre key={i}>{JSON.stringify(o,null,2)}</pre>))}
+      </div>
+    </div>
+  );
+}
+
+export default WhatIf;
+
*** End Patch
*** Begin Patch
*** Add File: tenant-ui/src/Login.js
+import React, {useState} from 'react';
+import axios from 'axios';
+
+function Login({onAuth}) {
+  const [user,setUser] = useState('');
+  const [error,setError] = useState(null);
+  async function login(){
+    try {
+      const r = await axios.post('/auth/login',{user});
+      const token = r.data.token;
+      localStorage.setItem('aegis_token', token);
+      onAuth(user);
+    } catch(e){
+      setError(e.message);
+    }
+  }
+  return (
+    <div>
+      <input placeholder="username" value={user} onChange={e=>setUser(e.target.value)} />
+      <button onClick={login}>Login</button>
+      {error && <div style={{color:'red'}}>{error}</div>}
+    </div>
+  );
+}
+export default Login;
+
*** End Patch
*** Begin Patch
*** Add File: tenant-ui/src/ProviderComparison.js
+import React, {useEffect, useState} from 'react';
+import { Bar } from 'react-chartjs-2';
+
+function ProviderComparison({region='US'}) {
+  const [data, setData] = useState(null);
+
+  useEffect(()=>{
+    // For demo: call an endpoint that returns provider candidates with cost & carbon estimates
+    fetch(`/api/providers?region=${region}`).then(r=>r.json()).then(j=>{
+      // expected: [{name, cost_usd, kgco2e}]
+      const labels = j.map(p=>p.name);
+      const cost = j.map(p=>p.cost_usd);
+      const carbon = j.map(p=>p.kgco2e);
+      setData({
+        labels,
+        datasets: [
+          { label: 'Cost (USD)', data: cost, backgroundColor: '#4caf50', yAxisID: 'y' },
+          { label: 'Carbon (kgCO2e)', data: carbon, backgroundColor: '#f44336', yAxisID: 'y1' }
+        ]
+      });
+    }).catch(()=>setData(null));
+  },[region]);
+
+  if(!data) return <div>Loading providers...</div>;
+  const options = {
+    scales: {
+      y: { type: 'linear', position: 'left' },
+      y1: { type: 'linear', position: 'right' }
+    }
+  };
+  return <div><h4>Provider comparison</h4><Bar data={data} options={options} /></div>;
+}
+
+export default ProviderComparison;
+
*** End Patch
*** Begin Patch
*** Modify File: tenant-ui/src/App.js
@@
-import WhatIf from './WhatIf';
-import TradeoffChart from './TradeoffChart';
-import Login from './Login';
-import TimeSeriesChart from './TimeSeriesChart';
+import WhatIf from './WhatIf';
+import TradeoffChart from './TradeoffChart';
+import Login from './Login';
+import TimeSeriesChart from './TimeSeriesChart';
+import ProviderComparison from './ProviderComparison';
@@
-            <h4>Forecast (next 48h)</h4>
-            <TimeSeriesChart region="US" hours={48} />
+            <h4>Forecast (next 48h)</h4>
+            <TimeSeriesChart region="US" hours={48} />
+            <ProviderComparison region="US" />
*** End Patch
