*** Begin Patch
*** Add File: scripts/package_and_attest_cosign.sh
+#!/usr/bin/env bash
+#
+# Produce DSSE attestation and Rekor entry using cosign (keyless preferred),
+# fallback to Vault-transit signing if cosign is not available.
+#
+# Usage:
+#   OBJECT_STORE_BUCKET=... REKOR_URL=... ./scripts/package_and_attest_cosign.sh <model_dir> <artifact_out_path>
+set -euo pipefail
+
+MODEL_DIR="${1:-}"
+OUT_TAR="${2:-}"
+
+if [ -z "$MODEL_DIR" ] || [ -z "$OUT_TAR" ]; then
+  echo "Usage: $0 <model_dir> <artifact_out_path>"
+  exit 2
+fi
+
+if [ ! -d "$MODEL_DIR" ]; then
+  echo "Model dir not found: $MODEL_DIR" >&2
+  exit 3
+fi
+
+TMPDIR=$(mktemp -d)
+trap 'rm -rf "$TMPDIR"' EXIT
+
+echo "Creating deterministic archive..."
+if [ -x scripts/make_deterministic_archive.py ]; then
+  python3 scripts/make_deterministic_archive.py "$MODEL_DIR" "$OUT_TAR"
+else
+  find "$MODEL_DIR" -type f | sort > "$TMPDIR/files.list"
+  tar --sort=name --mtime='UTC 2020-01-01' -czf "$OUT_TAR" -T "$TMPDIR/files.list"
+fi
+
+echo "Computing digest..."
+DIGEST_B64=$(openssl dgst -sha256 -binary "$OUT_TAR" | base64 -w 0)
+echo "digest: $DIGEST_B64"
+
+SIGJSON="${OUT_TAR}.sig.json"
+ATTEST="${OUT_TAR}.attestation.json"
+REKOR_RESP="${OUT_TAR}.rekor.json"
+SBOM="${OUT_TAR}.sbom.json"
+
+# Prefer cosign keyless signing (will upload to Rekor)
+if command -v cosign >/dev/null 2>&1; then
+  echo "Attempting cosign keyless sign (requires OIDC/keyless environment)..."
+  set +e
+  COSIGN_REKOR_OPTS=()
+  if [ -n "${REKOR_URL:-}" ]; then
+    COSIGN_REKOR_OPTS+=(--rekor-url "${REKOR_URL}")
+  fi
+  # create signature (cosign sign-blob will upload to Rekor and/or return signature)
+  cosign sign-blob --output-signature "$TMPDIR/sig.b64" --keyless "${COSIGN_REKOR_OPTS[@]}" "$OUT_TAR" >"$TMPDIR/cosign.out" 2>&1
+  COSIGN_EXIT=$?
+  set -e
+  if [ $COSIGN_EXIT -eq 0 ] && [ -f "$TMPDIR/sig.b64" ]; then
+    base64 -d "$TMPDIR/sig.b64" > "$TMPDIR/sig.bin" || true
+    # store base64-encoded signature in JSON to be consistent with other tooling
+    # best-effort: if tmp_sig variable exists use it, else use produced sig.bin
+    if [ -n "${tmp_sig:-}" ] 2>/dev/null; then
+      SIG_B64_CONTENT=$(base64 -w0 "$tmp_sig" 2>/dev/null || true)
+    else
+      SIG_B64_CONTENT=$(base64 -w0 "$TMPDIR/sig.bin" 2>/dev/null || true)
+    fi
+    jq -n --arg sig "$SIG_B64_CONTENT" '{data:{signature:$sig}}' > "$SIGJSON"
+    jq -n --arg art "$(basename "$OUT_TAR")" --arg d "$DIGEST_B64" --argjson s "$(jq -c . "$SIGJSON")" '{type:"dsse", subject:{artifact:$art,digest:$d}, signing:{method:"cosign-keyless"}, signature_json:$s}' > "$ATTEST"
+    echo "Attestation written to $ATTEST"
+    # Rekor response may be in cosign output; capture best-effort
+    echo '{}' > "$REKOR_RESP" || true
+  else
+    echo "cosign sign-blob failed or keyless not available (see $TMPDIR/cosign.out)"
+  fi
+fi
+
+# If cosign didn't produce a signature file, fallback to Vault transit
+if [ ! -f "$SIGJSON" ]; then
+  if [ -n "${VAULT_ADDR:-}" ] && [ -n "${VAULT_TOKEN:-}" ]; then
+    echo "Falling back to Vault transit signing..."
+    VAULT_ADDR="${VAULT_ADDR%/}"
+    SIGN_JSON=$(curl -sS --header "X-Vault-Token: $VAULT_TOKEN" --request POST --data "{\"input\":\"${DIGEST_B64}\"}" "${VAULT_ADDR}/v1/transit/sign/aegis-cosign")
+    echo "$SIGN_JSON" > "$SIGJSON"
+    jq -n --arg art "$(basename "$OUT_TAR")" --arg d "$DIGEST_B64" --argjson s "$(jq -c . "$SIGJSON")" '{type:"dsse", subject:{artifact:$art,digest:$d}, signing:{method:"vault-transit"}, signature_json:$s}' > "$ATTEST"
+    echo "Attestation written to $ATTEST"
+  else
](#)
î€€
